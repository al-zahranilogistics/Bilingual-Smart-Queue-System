<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Al-Zahrani Logistics - Display Screen</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;900&family=Inter:wght@400;700;900&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>

    <style>
        :root {
            --primary-blue: #1e40af;
            --secondary-blue: #3b82f6;
            --accent-teal: #06b6d4;
            --success-green: #10b981;
        }
        
        body { 
            font-family: 'Cairo', 'Inter', sans-serif; 
            margin: 0; 
            padding: 0;
            overflow: hidden;
            background: #0f172a;
        }
        
        .arabic { font-family: 'Cairo', sans-serif; }
        .english { font-family: 'Inter', sans-serif; direction: ltr; text-align: left; }
        
        /* Display Screen - Optimized for TV */
        .display-container {
            width: 100vw;
            height: 100vh;
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            display: flex;
            flex-direction: column;
        }
        
        .ticket-glow {
            text-shadow: 
                0 0 30px rgba(59, 130, 246, 0.8),
                0 0 60px rgba(59, 130, 246, 0.6),
                0 0 90px rgba(59, 130, 246, 0.4);
            animation: glowPulse 2s infinite alternate;
        }
        
        @keyframes glowPulse {
            from {
                text-shadow: 
                    0 0 20px rgba(59, 130, 246, 0.7),
                    0 0 40px rgba(59, 130, 246, 0.5),
                    0 0 60px rgba(59, 130, 246, 0.3);
            }
            to {
                text-shadow: 
                    0 0 30px rgba(59, 130, 246, 0.9),
                    0 0 60px rgba(59, 130, 246, 0.7),
                    0 0 90px rgba(59, 130, 246, 0.5);
            }
        }
        
        .current-call-container {
            flex: 0.7;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        
        .recent-calls-container {
            flex: 0.3;
            background: rgba(0, 0, 0, 0.4);
            backdrop-filter: blur(10px);
            padding: 15px;
            border-top: 3px solid #3b82f6;
        }
        
        @keyframes slideIn {
            from { transform: translateY(-20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        @keyframes marquee {
            0% { transform: translateX(100%); }
            100% { transform: translateX(-100%); }
        }
        
        .animate-slide-in { animation: slideIn 0.5s ease-out; }
        .animate-marquee { animation: marquee 30s linear infinite; }
        
        /* Responsive font sizes */
        @media (max-width: 768px) {
            .ticket-number {
                font-size: 15vw;
            }
            .department-name {
                font-size: 5vw;
            }
            .room-name {
                font-size: 4vw;
            }
        }
        
        @media (min-width: 769px) and (max-width: 1200px) {
            .ticket-number {
                font-size: 12vw;
            }
            .department-name {
                font-size: 4vw;
            }
            .room-name {
                font-size: 3vw;
            }
        }
        
        @media (min-width: 1201px) {
            .ticket-number {
                font-size: 10vw;
            }
            .department-name {
                font-size: 3vw;
            }
            .room-name {
                font-size: 2.5vw;
            }
        }
        
        /* Ticker styles */
        .ticker-container {
            background: linear-gradient(90deg, #1e40af, #3b82f6);
            height: 50px;
            overflow: hidden;
            position: relative;
        }
        
        .ticker-content {
            position: absolute;
            white-space: nowrap;
            animation: marquee 40s linear infinite;
        }
        
        /* Recent calls styling */
        .recent-ticket {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 12px;
            margin-bottom: 8px;
            border-right: 4px solid;
            transition: all 0.3s ease;
        }
        
        .recent-ticket:hover {
            background: rgba(255, 255, 255, 0.15);
            transform: translateX(-5px);
        }
        
        /* Time display */
        .time-display {
            font-family: 'Courier New', monospace;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            padding: 5px 15px;
            border: 2px solid #3b82f6;
        }
        
        /* Status indicator */
        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 8px;
        }
        
        .status-online {
            background-color: #10b981;
            box-shadow: 0 0 10px #10b981;
        }
        
        .status-offline {
            background-color: #ef4444;
            box-shadow: 0 0 10px #ef4444;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        // === Firebase Configuration ===
        const firebaseConfig = {
            apiKey: "AIzaSyA2WwSnB54y4Xf3p_WPFHeSf7QOGgi3rS8",
            authDomain: "zahrani-4bbf3.firebaseapp.com",
            databaseURL: "https://zahrani-4bbf3-default-rtdb.firebaseio.com",
            projectId: "zahrani-4bbf3",
            storageBucket: "zahrani-4bbf3.firebasestorage.app",
            messagingSenderId: "76127187270",
            appId: "1:76127187270:web:c0d8869fc61275da5ab547"
        };

        // Initialize Firebase
        try {
            firebase.initializeApp(firebaseConfig);
        } catch (error) {
            console.log("Firebase already initialized");
        }

        const db = firebase.firestore();
        const realtimeDB = firebase.database();

        // === System Configuration ===
        const CONFIG = {
            companyName: {
                ar: "ÿßŸÑÿ≤Ÿáÿ±ÿßŸÜŸä ŸÑŸÑÿÆÿØŸÖÿßÿ™ ÿßŸÑŸÑŸàÿ¨ÿ≥ÿ™Ÿäÿ©",
                en: "Al-Zahrani Logistics"
            },
            systemName: {
                ar: "ŸÜÿ∏ÿßŸÖ ÿ•ÿØÿßÿ±ÿ© ÿßŸÑÿ∑Ÿàÿßÿ®Ÿäÿ± ÿßŸÑÿ∞ŸÉŸä",
                en: "Smart Queue Management System"
            },
            departments: [
                { 
                    id: 'vehicles', 
                    nameAr: "ŸÇÿ≥ŸÖ ÿßŸÑŸÖÿ±ŸÉÿ®ÿßÿ™", 
                    nameEn: "Vehicles Department",
                    prefix: "V", 
                    roomAr: "ŸÖŸÉÿ™ÿ® ÿßŸÑŸÖÿ±ŸÉÿ®ÿßÿ™", 
                    roomEn: "Vehicles Office", 
                    color: "#3b82f6",
                    icon: "fa-solid fa-truck",
                    iconColor: "#1d4ed8"
                },
                { 
                    id: 'finance', 
                    nameAr: "ŸÇÿ≥ŸÖ ÿßŸÑŸÖÿßŸÑŸäÿ©", 
                    nameEn: "Finance Department",
                    prefix: "F", 
                    roomAr: "ŸÖŸÉÿ™ÿ® ÿßŸÑŸÖÿØŸäÿ± ÿßŸÑŸÖÿßŸÑŸä", 
                    roomEn: "Finance Office", 
                    color: "#10b981",
                    icon: "fa-solid fa-money-bill-wave",
                    iconColor: "#047857"
                },
                { 
                    id: 'supervisors', 
                    nameAr: "ŸÖÿØŸäÿ± ÿßŸÑÿ™ÿ¥ÿ∫ŸäŸÑ", 
                    nameEn: "Supervisors Department",
                    prefix: "S", 
                    roomAr: "ŸÖÿØŸäÿ± ÿßŸÑÿ™ÿ¥ÿ∫ŸäŸÑ", 
                    roomEn: "Supervisors Office", 
                    color: "#8b5cf6",
                    icon: "fa-solid fa-user-tie",
                    iconColor: "#7c3aed"
                },
                { 
                    id: 'ninja_sup', 
                    nameAr: "ŸÖÿ¥ÿ±ŸÅ ŸÜŸäŸÜÿ¨ÿß", 
                    nameEn: "Ninja Supervisor",
                    prefix: "NS", 
                    roomAr: "ŸÖŸÉÿ™ÿ® ŸÖÿ¥ÿ±ŸÅ ŸÜŸäŸÜÿ¨ÿß", 
                    roomEn: "Ninja Supervisor Office", 
                    color: "#ec4899",
                    icon: "fa-solid fa-user-ninja",
                    iconColor: "#be185d"
                },
                { 
                    id: 'kmart_ninja', 
                    nameAr: "ŸÖÿ¥ÿ±ŸÅ ŸÉŸäŸÖÿßÿ±ÿ™", 
                    nameEn: "K-Mart Department",
                    prefix: "K", 
                    roomAr: "ŸÖŸÉÿ™ÿ® ŸÉŸäŸÖÿßÿ±ÿ™", 
                    roomEn: "K-Mart Office", 
                    color: "#f59e0b",
                    icon: "fa-solid fa-store",
                    iconColor: "#d97706"
                },
                { 
                    id: 'hr', 
                    nameAr: "ÿßŸÑŸÖŸàÿßÿ±ÿØ ÿßŸÑÿ®ÿ¥ÿ±Ÿäÿ©", 
                    nameEn: "Human Resources",
                    prefix: "HR", 
                    roomAr: "ŸÖŸÉÿ™ÿ® ÿßŸÑŸÖŸàÿßÿ±ÿØ ÿßŸÑÿ®ÿ¥ÿ±Ÿäÿ©", 
                    roomEn: "HR Office", 
                    color: "#ef4444",
                    icon: "fa-solid fa-users",
                    iconColor: "#dc2626"
                },
                { 
                    id: 'petroleum', 
                    nameAr: "ŸÇÿ≥ŸÖ ÿßŸÑÿ®ÿ™ÿ±ŸàŸÑ", 
                    nameEn: "Petroleum Department",
                    prefix: "P", 
                    roomAr: "ŸÖŸÉÿ™ÿ® ÿßŸÑÿ®ÿ™ÿ±ŸàŸÑ", 
                    roomEn: "Petroleum Office", 
                    color: "#06b6d4",
                    icon: "fa-solid fa-gas-pump",
                    iconColor: "#0891b2"
                },
                { 
                    id: 'naqel_mgr', 
                    nameAr: "ŸÖÿØŸäÿ± ÿ™ÿ¥ÿ∫ŸäŸÑ ŸÅŸÑŸà Ÿà ŸÜÿßŸÇŸÑ", 
                    nameEn: "Naqel Project",
                    prefix: "ON", 
                    roomAr: "ŸÖŸÉÿ™ÿ® ŸÖÿØŸäÿ± ÿßŸÑÿ™ÿ¥ÿ∫ŸäŸÑ", 
                    roomEn: "Naqel Project Office", 
                    color: "#8b5cf6",
                    icon: "fa-solid fa-truck-fast",
                    iconColor: "#7c3aed"
                },
                { 
                    id: 'ninja_mgr', 
                    nameAr: "ŸÖÿ¥ÿ±Ÿàÿπ ŸÜŸäŸÜÿ¨ÿß", 
                    nameEn: "Ninja Project",
                    prefix: "PN", 
                    roomAr: "ŸÖŸÉÿ™ÿ® ŸÖÿ¥ÿ±Ÿàÿπ ŸÜŸäŸÜÿ¨ÿß", 
                    roomEn: "Ninja Project Office", 
                    color: "#6366f1",
                    icon: "fa-solid fa-bolt",
                    iconColor: "#4f46e5"
                }
            ]
        };

        // === Language Data ===
        const LANGUAGES = {
            ar: {
                currentCall: "ÿßŸÑŸÜÿØÿßÿ° ÿßŸÑÿ≠ÿßŸÑŸä",
                recentCalls: "ÿßŸÑÿ™ÿ∞ÿßŸÉÿ± ÿßŸÑŸÖŸÜÿØÿßÿ© ŸÖÿ§ÿÆÿ±ÿßŸã",
                welcomeMessage: "ÿ¥ÿ±ŸÉÿ© ÿßŸÑÿ≤Ÿáÿ±ÿßŸÜŸä ŸÑŸÑÿÆÿØŸÖÿßÿ™ ÿßŸÑŸÑŸàÿ¨ÿ≥ÿ™Ÿäÿ© ÿ™ÿ±ÿ≠ÿ® ÿ®ŸÉŸÖ",
                systemMessage: "ŸÜÿ∏ÿßŸÖ ÿ•ÿØÿßÿ±ÿ© ÿßŸÑÿ∑Ÿàÿßÿ®Ÿäÿ± ÿßŸÑÿ∞ŸÉŸä",
                holdTicket: "Ÿäÿ±ÿ¨Ÿâ ÿßŸÑÿßÿ≠ÿ™ŸÅÿßÿ∏ ÿ®ÿ±ŸÇŸÖ ÿßŸÑÿ™ÿ∞ŸÉÿ±ÿ™ŸÉ ŸàÿßŸÑŸÖÿ™ÿßÿ®ÿπÿ© ÿπŸÑŸâ ÿßŸÑÿ¥ÿßÿ¥ÿ©",
                waitingService: "ÿ®ÿßŸÜÿ™ÿ∏ÿßÿ± ÿßŸÑÿÆÿØŸÖÿ©...",
                proceedTo: "ÿ™Ÿàÿ¨Ÿá ÿ•ŸÑŸâ",
                pleaseWait: "Ÿäÿ±ÿ¨Ÿâ ÿßŸÑÿßŸÜÿ™ÿ∏ÿßÿ± ŸÅŸä ŸÖŸÜÿ∑ŸÇÿ© ÿßŸÑÿßŸÜÿ™ÿ∏ÿßÿ±",
                lastUpdate: "ÿ¢ÿÆÿ± ÿ™ÿ≠ÿØŸäÿ´",
                connected: "ŸÖÿ™ÿµŸÑ ÿ®ÿßŸÑŸÜÿ∏ÿßŸÖ",
                disconnected: "ÿ∫Ÿäÿ± ŸÖÿ™ÿµŸÑ"
            },
            en: {
                currentCall: "Current Call",
                recentCalls: "Recent Calls",
                welcomeMessage: "Al-Zahrani Logistics welcomes you",
                systemMessage: "Smart Queue Management System",
                holdTicket: "Please keep your ticket number and follow the screen",
                waitingService: "Waiting for service...",
                proceedTo: "Proceed to",
                pleaseWait: "Please wait in the waiting area",
                lastUpdate: "Last update",
                connected: "System Connected",
                disconnected: "Disconnected"
            }
        };

        const { useState, useEffect, useRef } = React;

        // === Speech Announcement Function ===
        const speakAnnouncement = (ticketNumber, roomAr, roomEn, departmentAr, departmentEn) => {
            if ('speechSynthesis' in window) {
                // Stop any ongoing speech
                speechSynthesis.cancel();
                
                // Arabic announcement
                const arabicText = `ÿßŸÑÿ™ÿ∞ŸÉÿ±ÿ© ÿ±ŸÇŸÖ ${ticketNumber}ÿå Ÿäÿ±ÿ¨Ÿâ ÿßŸÑÿ™Ÿàÿ¨Ÿá ÿ•ŸÑŸâ ${roomAr}`;
                const utteranceAr = new SpeechSynthesisUtterance(arabicText);
                utteranceAr.lang = 'ar-SA';
                utteranceAr.rate = 0.8; // ÿ£ÿ®ÿ∑ÿ£ ŸÇŸÑŸäŸÑÿßŸã ŸÑŸÑŸàÿ∂Ÿàÿ≠
                utteranceAr.pitch = 1;
                utteranceAr.volume = 1;
                
                // English announcement
                const englishText = `Ticket number ${ticketNumber}, please proceed to ${roomEn}`;
                const utteranceEn = new SpeechSynthesisUtterance(englishText);
                utteranceEn.lang = 'en-US';
                utteranceEn.rate = 0.8;
                utteranceEn.pitch = 1;
                utteranceEn.volume = 1;
                
                // Speak Arabic first, then English after delay
                speechSynthesis.speak(utteranceAr);
                
                utteranceAr.onend = () => {
                    setTimeout(() => {
                        speechSynthesis.speak(utteranceEn);
                    }, 1000); // ÿßŸÜÿ™ÿ∏ÿ± ÿ´ÿßŸÜŸäÿ© ÿ®ŸäŸÜ ÿßŸÑŸÑÿ∫ÿ™ŸäŸÜ
                };
            }
        };

        // === Display Screen Component ===
        function DisplayScreen() {
            const [language, setLanguage] = useState('ar');
            const [currentTime, setCurrentTime] = useState(new Date());
            const [currentCalls, setCurrentCalls] = useState({});
            const [tickets, setTickets] = useState([]);
            const [isOnline, setIsOnline] = useState(true);
            const [lastAnnouncement, setLastAnnouncement] = useState(null);
            const [isSpeaking, setIsSpeaking] = useState(false);
            
            const lastCalledRef = useRef({});
            const t = LANGUAGES[language];
            const isRTL = language === 'ar';

            // Initialize Firebase
            useEffect(() => {
                // Subscribe to current calls from Realtime Database
                const unsubscribeCalls = realtimeDB.ref('currentCalls').on('value', snapshot => {
                    const calls = snapshot.val() || {};
                    setCurrentCalls(calls);
                    
                    // Check for new calls to announce
                    Object.entries(calls).forEach(([deptId, call]) => {
                        if (call && call.ticketNumber) {
                            const callKey = `${deptId}_${call.ticketNumber}`;
                            const lastCalled = lastCalledRef.current[callKey];
                            
                            if (!lastCalled || (Date.now() - lastCalled) > 10000) { // Prevent repeating within 10 seconds
                                const dept = CONFIG.departments.find(d => d.id === deptId);
                                if (dept) {
                                    speakAnnouncement(
                                        call.ticketNumber,
                                        dept.roomAr,
                                        dept.roomEn,
                                        dept.nameAr,
                                        dept.nameEn
                                    );
                                    lastCalledRef.current[callKey] = Date.now();
                                    setLastAnnouncement({
                                        ticketNumber: call.ticketNumber,
                                        department: dept,
                                        timestamp: Date.now()
                                    });
                                }
                            }
                        }
                    });
                }, error => {
                    console.error('Error subscribing to current calls:', error);
                    setIsOnline(false);
                });

                // Subscribe to tickets from Firestore
                const unsubscribeTickets = db.collection('tickets')
                    .where('status', '==', 'called')
                    .orderBy('calledAt', 'desc')
                    .limit(10)
                    .onSnapshot(snapshot => {
                        const ticketList = [];
                        snapshot.forEach(doc => {
                            ticketList.push({ id: doc.id, ...doc.data() });
                        });
                        setTickets(ticketList);
                    }, error => {
                        console.error('Error subscribing to tickets:', error);
                    });

                // Update time every second
                const timer = setInterval(() => {
                    setCurrentTime(new Date());
                }, 1000);

                // Check online status
                const handleOnline = () => setIsOnline(true);
                const handleOffline = () => setIsOnline(false);
                
                window.addEventListener('online', handleOnline);
                window.addEventListener('offline', handleOffline);

                return () => {
                    unsubscribeCalls();
                    unsubscribeTickets();
                    clearInterval(timer);
                    window.removeEventListener('online', handleOnline);
                    window.removeEventListener('offline', handleOffline);
                    speechSynthesis.cancel();
                };
            }, []);

            // Format time
            const formatTime = (date) => {
                return date.toLocaleTimeString(isRTL ? 'ar-SA' : 'en-US', {
                    hour: '2-digit',
                    minute: '2-digit',
                    second: '2-digit'
                });
            };

            const formatDate = (date) => {
                return date.toLocaleDateString(isRTL ? 'ar-SA' : 'en-US', {
                    weekday: 'long',
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric'
                });
            };

            // Get current call for display
            const getCurrentCall = () => {
                const calls = Object.values(currentCalls);
                if (calls.length === 0) return null;
                
                // Find the most recent call
                const mostRecent = calls.reduce((latest, call) => {
                    return (!latest || call.calledAt > latest.calledAt) ? call : latest;
                }, null);
                
                return mostRecent;
            };

            // Get department info for a call
            const getDepartmentInfo = (call) => {
                if (!call) return null;
                
                // Find department by ID
                const deptId = Object.keys(currentCalls).find(key => currentCalls[key] === call);
                if (deptId) {
                    return CONFIG.departments.find(d => d.id === deptId);
                }
                
                // Fallback to department info from call data
                return {
                    nameAr: call.departmentNameAr || "ÿßŸÑŸÇÿ≥ŸÖ",
                    nameEn: call.departmentNameEn || "Department",
                    roomAr: call.roomAr || "ÿßŸÑŸÖŸÉÿ™ÿ®",
                    roomEn: call.roomEn || "Office",
                    color: "#3b82f6"
                };
            };

            // Get recent called tickets
            const getRecentCalls = () => {
                return tickets.slice(0, 5); // Last 5 called tickets
            };

            const currentCall = getCurrentCall();
            const currentDept = getDepartmentInfo(currentCall);
            const recentCalls = getRecentCalls();

            return (
                <div className="display-container">
                    {/* Header */}
                    <div className="bg-gradient-to-r from-blue-900 to-blue-800 text-white p-3">
                        <div className="flex justify-between items-center">
                            <div className="flex items-center gap-3">
                                <div className="bg-white p-2 rounded-lg">
                                    <i className="fas fa-truck text-xl text-blue-600"></i>
                                </div>
                                <div>
                                    <h1 className="text-lg font-bold arabic">
                                        {CONFIG.companyName.ar}
                                    </h1>
                                    <h1 className="text-sm font-bold english">
                                        {CONFIG.companyName.en}
                                    </h1>
                                </div>
                            </div>
                            
                            <div className="flex items-center gap-4">
                                <div className="text-right">
                                    <div className="text-xl font-mono font-bold">
                                        {formatTime(currentTime)}
                                    </div>
                                    <div className="text-xs opacity-80">
                                        {formatDate(currentTime)}
                                    </div>
                                </div>
                                
                                <div className="flex items-center gap-2">
                                    <span className={`status-indicator ${isOnline ? 'status-online' : 'status-offline'}`}></span>
                                    <span className="text-sm">
                                        {isOnline ? t.connected : t.disconnected}
                                    </span>
                                </div>
                                
                                <button
                                    onClick={() => setLanguage(lang => lang === 'ar' ? 'en' : 'ar')}
                                    className="px-3 py-1 bg-white/20 hover:bg-white/30 rounded-lg text-sm"
                                >
                                    {language === 'ar' ? 'EN' : 'ÿπÿ±ÿ®Ÿä'}
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    {/* Current Call - Main Display */}
                    <div className="current-call-container">
                        <div className="text-center space-y-6 w-full px-4">
                            <div className="text-blue-400 text-2xl font-bold mb-2">
                                {t.currentCall}
                            </div>
                            
                            {currentCall ? (
                                <div className="animate-slide-in">
                                    <div className="relative">
                                        <div className="ticket-number font-black text-white ticket-glow mb-2">
                                            {currentCall.ticketNumber}
                                        </div>
                                        {currentDept && (
                                            <div className="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 text-6xl opacity-20">
                                                <i className={currentDept.icon}></i>
                                            </div>
                                        )}
                                    </div>
                                    
                                    {currentDept && (
                                        <div className="space-y-3 mt-6">
                                            <div className="department-name font-bold text-blue-300 arabic">
                                                {currentDept.nameAr}
                                            </div>
                                            <div className="department-name font-bold text-blue-300 english">
                                                {currentDept.nameEn}
                                            </div>
                                            
                                            <div className="space-y-1">
                                                <div className="room-name text-blue-200 arabic">
                                                    <i className="fas fa-map-marker-alt ml-2"></i>
                                                    {t.proceedTo} {currentDept.roomAr}
                                                </div>
                                                <div className="room-name text-blue-200 english">
                                                    <i className="fas fa-map-marker-alt mr-2"></i>
                                                    {t.proceedTo} {currentDept.roomEn}
                                                </div>
                                            </div>
                                        </div>
                                    )}
                                    
                                    {lastAnnouncement && lastAnnouncement.ticketNumber === currentCall.ticketNumber && (
                                        <div className="mt-4 text-green-300 text-sm">
                                            <i className="fas fa-volume-up mr-2"></i>
                                            {isRTL ? 'ÿ™ŸÖ ÿßŸÑÿ•ÿπŸÑÿßŸÜ ÿπŸÜ ÿßŸÑÿ™ÿ∞ŸÉÿ±ÿ©' : 'Ticket announced'}
                                        </div>
                                    )}
                                </div>
                            ) : (
                                <div className="space-y-4">
                                    <div className="text-8xl opacity-30">
                                        <i className="fas fa-clock"></i>
                                    </div>
                                    <div className="space-y-2">
                                        <div className="text-3xl text-gray-400 arabic">{t.waitingService}</div>
                                        <div className="text-2xl text-gray-400 english">{t.waitingService}</div>
                                        <div className="text-lg text-gray-500 mt-4">
                                            {t.pleaseWait}
                                        </div>
                                    </div>
                                </div>
                            )}
                        </div>
                    </div>
                    
                    {/* Recent Calls */}
                    <div className="recent-calls-container">
                        <div className="h-full flex flex-col">
                            <h3 className="text-lg font-bold text-white mb-3 border-b border-blue-500 pb-2">
                                <i className="fas fa-history ml-2"></i>
                                {t.recentCalls}
                            </h3>
                            
                            <div className="flex-1 overflow-y-auto">
                                <div className="space-y-2">
                                    {recentCalls.map((ticket, index) => {
                                        const dept = CONFIG.departments.find(d => d.id === ticket.deptId);
                                        return (
                                            <div 
                                                key={ticket.id}
                                                className="recent-ticket animate-slide-in"
                                                style={{ 
                                                    borderRightColor: dept?.color || '#3b82f6',
                                                    animationDelay: `${index * 0.1}s`
                                                }}
                                            >
                                                <div className="flex justify-between items-center">
                                                    <div>
                                                        <div className="text-xl font-bold text-white">
                                                            {ticket.number}
                                                        </div>
                                                        <div className="text-sm text-gray-300">
                                                            {dept ? (isRTL ? dept.nameAr : dept.nameEn) : ''}
                                                        </div>
                                                    </div>
                                                    <div className="text-right">
                                                        <div className="text-xs text-gray-400">
                                                            {formatTime(ticket.calledAt?.toDate?.() || new Date(ticket.calledAt))}
                                                        </div>
                                                        {dept && (
                                                            <div className="text-lg opacity-70">
                                                                <i className={dept.icon}></i>
                                                            </div>
                                                        )}
                                                    </div>
                                                </div>
                                            </div>
                                        );
                                    })}
                                    
                                    {recentCalls.length === 0 && (
                                        <div className="text-center py-8 text-gray-400">
                                            <i className="fas fa-ticket-alt text-3xl mb-2"></i>
                                            <div>{isRTL ? 'ŸÑÿß ÿ™Ÿàÿ¨ÿØ ÿ™ÿ∞ÿßŸÉÿ± ŸÖŸÜÿßÿØÿßÿ©' : 'No tickets called yet'}</div>
                                        </div>
                                    )}
                                </div>
                            </div>
                            
                            <div className="text-xs text-gray-400 mt-2 text-center">
                                <i className="fas fa-sync-alt mr-1"></i>
                                {t.lastUpdate}: {formatTime(currentTime)}
                            </div>
                        </div>
                    </div>
                    
                    {/* Ticker */}
                    <div className="ticker-container">
                        <div className="ticker-content text-white text-lg font-medium py-3">
                            <span className="mx-8">üéâ {t.welcomeMessage}</span>
                            <span className="mx-8">‚Ä¢</span>
                            <span className="mx-8">üìã {t.systemMessage}</span>
                            <span className="mx-8">‚Ä¢</span>
                            <span className="mx-8">üé´ {t.holdTicket}</span>
                            <span className="mx-8">‚Ä¢</span>
                            <span className="mx-8">üè¢ {CONFIG.companyName.ar}</span>
                            <span className="mx-8">‚Ä¢</span>
                            <span className="mx-8">üè¢ {CONFIG.companyName.en}</span>
                        </div>
                    </div>
                </div>
            );
        }

        // Initialize the display screen
        ReactDOM.createRoot(document.getElementById('root')).render(<DisplayScreen />);
    </script>
</body>
</html>
