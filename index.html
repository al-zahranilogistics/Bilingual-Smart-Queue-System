<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ø§Ù„Ø²Ù‡Ø±Ø§Ù†ÙŠ Ù„Ù„Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ù„ÙˆØ¬Ø³ØªÙŠØ© - Ù†Ø¸Ø§Ù… Ø§Ù„Ø·Ø§Ø¨ÙˆØ± Ø§Ù„Ø°ÙƒÙŠ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;900&family=Inter:wght@400;700;900&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>

    <style>
        /* ===== ØªØ­Ø³ÙŠÙ†Ø§Øª Ø§Ù„ØªØµÙ…ÙŠÙ… Ø§Ù„Ø¹Ø§Ù… ===== */
        :root {
            --primary-blue: #1e3a8a;
            --secondary-blue: #3b82f6;
            --accent-teal: #06b6d4;
            --success-green: #10b981;
            --warning-orange: #f59e0b;
            --danger-red: #ef4444;
            --light-gray: #f8fafc;
            --dark-gray: #1e293b;
        }
        
        * {
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }
        
        body {
            font-family: 'Cairo', 'Inter', sans-serif;
            margin: 0;
            padding: 0;
            background: var(--light-gray);
            overflow-x: hidden;
        }
        
        .arabic { 
            font-family: 'Cairo', sans-serif; 
            direction: rtl;
        }
        
        .english { 
            font-family: 'Inter', sans-serif; 
            direction: ltr;
        }
        
        /* ===== ØªØ­Ø³ÙŠÙ†Ø§Øª ÙƒØ´Ùƒ Ø§Ù„Ø²ÙˆØ§Ø± Ù„Ù„Ø£Ø¬Ù‡Ø²Ø© Ø§Ù„Ù…Ø­Ù…ÙˆÙ„Ø© ===== */
        @media (max-width: 768px) {
            .mobile-optimized {
                padding: 15px !important;
            }
            
            .mobile-grid {
                grid-template-columns: 1fr !important;
                gap: 15px !important;
            }
            
            .mobile-card {
                padding: 15px !important;
                margin-bottom: 10px !important;
            }
            
            .mobile-text {
                font-size: 16px !important;
            }
            
            .mobile-title {
                font-size: 20px !important;
                margin-bottom: 15px !important;
            }
            
            .mobile-button {
                padding: 12px 20px !important;
                font-size: 16px !important;
                width: 100% !important;
            }
            
            .mobile-header {
                flex-direction: column !important;
                gap: 15px !important;
                padding: 15px !important;
            }
            
            .mobile-footer {
                padding: 20px 15px !important;
                text-align: center !important;
            }
            
            .mobile-logo {
                width: 70px !important;
                height: 70px !important;
            }
        }
        
        /* ===== ØªØ­Ø³ÙŠÙ†Ø§Øª Ø§Ù„ØªØ°ÙƒØ±Ø© Ø§Ù„Ù…Ù†ØªØ¸Ø±Ø© ===== */
        .compact-ticket {
            padding: 12px 15px !important;
            margin: 8px 0 !important;
            border-radius: 12px !important;
            background: rgba(255, 255, 255, 0.7) !important;
            backdrop-filter: blur(8px) !important;
            border: 1px solid rgba(59, 130, 246, 0.2) !important;
            transition: all 0.3s ease !important;
            animation: slideUp 0.5s ease-out !important;
        }
        
        .compact-ticket:hover {
            transform: translateX(-5px) !important;
            background: white !important;
            border-color: rgba(59, 130, 246, 0.4) !important;
            box-shadow: 0 5px 15px rgba(59, 130, 246, 0.1) !important;
        }
        
        .compact-ticket-number {
            font-size: 22px !important;
            font-weight: 900 !important;
            color: var(--secondary-blue) !important;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1) !important;
        }
        
        .compact-ticket-info {
            font-size: 13px !important;
            color: #64748b !important;
            line-height: 1.4 !important;
        }
        
        .ticket-badge {
            padding: 4px 10px !important;
            font-size: 11px !important;
            border-radius: 20px !important;
            font-weight: bold !important;
        }
        
        .approved-badge {
            background: linear-gradient(135deg, var(--success-green), #34d399) !important;
            color: white !important;
            animation: pulse 2s infinite !important;
        }
        
        .waiting-badge {
            background: linear-gradient(135deg, var(--warning-orange), #fbbf24) !important;
            color: white !important;
        }
        
        @keyframes slideUp {
            from {
                transform: translateY(20px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.8; }
        }
        
        /* ===== ØªØ­Ø³ÙŠÙ†Ø§Øª Ø´Ø§Ø´Ø© Ø§Ù„Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø­Ø³Ù†Ø© ===== */
        .display-container {
            width: 100vw !important;
            height: 100vh !important;
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%) !important;
            overflow: hidden !important;
            position: relative !important;
        }
        
        .display-header {
            background: linear-gradient(90deg, var(--primary-blue), var(--secondary-blue)) !important;
            padding: 15px 30px !important;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3) !important;
            position: relative !important;
            z-index: 10 !important;
            height: 80px !important;
        }
        
        .current-call-container {
            flex: 1 !important;
            display: flex !important;
            flex-direction: column !important;
            justify-content: center !important;
            align-items: center !important;
            padding: 20px !important;
            background: rgba(0, 0, 0, 0.2) !important;
            height: calc(100vh - 80px - 50px) !important;
        }
        
        /* ===== ØªÙ‚Ù„ÙŠÙ„ Ø­Ø¬Ù… Ø£Ø±Ù‚Ø§Ù… Ø§Ù„ØªØ°Ø§ÙƒØ± ÙÙŠ Ø§Ù„Ø´Ø§Ø´Ø© ===== */
        .current-ticket-number {
            font-size: 18vw !important; /* ØªÙ… Ø§Ù„ØªØµØºÙŠØ± Ù…Ù† 35vw */
            font-weight: 900 !important;
            color: white !important;
            text-shadow: 
                0 0 30px rgba(59, 130, 246, 0.9),
                0 0 60px rgba(59, 130, 246, 0.7),
                0 0 90px rgba(59, 130, 246, 0.5) !important;
            line-height: 1 !important;
            margin: 0 !important;
            animation: glow 3s infinite alternate !important;
        }
        
        @keyframes glow {
            from {
                text-shadow: 
                    0 0 20px rgba(59, 130, 246, 0.8),
                    0 0 40px rgba(59, 130, 246, 0.6),
                    0 0 60px rgba(59, 130, 246, 0.4) !important;
            }
            to {
                text-shadow: 
                    0 0 30px rgba(59, 130, 246, 1),
                    0 0 60px rgba(59, 130, 246, 0.8),
                    0 0 90px rgba(59, 130, 246, 0.6) !important;
            }
        }
        
        .current-ticket-info {
            text-align: center !important;
            margin-top: 20px !important;
        }
        
        /* ===== ØªÙ‚Ù„ÙŠÙ„ Ø­Ø¬Ù… Ø§Ù„Ù†ØµÙˆØµ ÙÙŠ Ø§Ù„Ø´Ø§Ø´Ø© ===== */
        .current-office {
            font-size: 2.5vw !important; /* ØªÙ… Ø§Ù„ØªØµØºÙŠØ± Ù…Ù† 4vw */
            color: #93c5fd !important;
            font-weight: 700 !important;
            margin-bottom: 8px !important;
        }
        
        .current-department {
            font-size: 2vw !important; /* ØªÙ… Ø§Ù„ØªØµØºÙŠØ± Ù…Ù† 3vw */
            color: #cbd5e1 !important;
            font-weight: 600 !important;
        }
        
        /* ===== ØªÙ‚Ù„ÙŠÙ„ Ø­Ø¬Ù… Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠ ===== */
        .tickets-sidebar {
            width: 32% !important; /* ØªÙ… Ø§Ù„ØªØµØºÙŠØ± Ù…Ù† 35% */
            background: rgba(30, 41, 59, 0.85) !important;
            backdrop-filter: blur(12px) !important;
            border-left: 2px solid rgba(59, 130, 246, 0.4) !important;
            padding: 20px !important;
            overflow-y: auto !important;
            display: flex !important;
            flex-direction: column !important;
            height: calc(100vh - 80px - 50px) !important;
        }
        
        @media (max-width: 1024px) {
            .tickets-sidebar {
                width: 40% !important;
            }
            
            .current-ticket-number {
                font-size: 22vw !important;
            }
            
            .current-office {
                font-size: 3.5vw !important;
            }
            
            .current-department {
                font-size: 2.8vw !important;
            }
        }
        
        @media (max-width: 768px) {
            .display-container {
                flex-direction: column !important;
            }
            
            .tickets-sidebar {
                width: 100% !important;
                border-left: none !important;
                border-top: 2px solid rgba(59, 130, 246, 0.4) !important;
                height: 45% !important;
            }
            
            .current-ticket-number {
                font-size: 25vw !important;
            }
            
            .current-office {
                font-size: 4vw !important;
            }
            
            .current-department {
                font-size: 3.2vw !important;
            }
            
            .display-header {
                padding: 12px 20px !important;
                height: 70px !important;
            }
            
            .current-call-container {
                height: calc(100vh - 70px - 45% - 50px) !important;
            }
        }
        
        @media (max-height: 600px) {
            .display-header {
                padding: 10px 15px !important;
                height: 60px !important;
            }
            
            .current-call-container {
                padding: 10px !important;
            }
            
            .current-ticket-number {
                font-size: 20vw !important;
            }
            
            .tickets-sidebar {
                padding: 15px !important;
            }
        }
        
        .tickets-section {
            margin-bottom: 20px !important;
            flex: 1 !important;
            display: flex !important;
            flex-direction: column !important;
        }
        
        /* ===== ØªÙ‚Ù„ÙŠÙ„ Ø­Ø¬Ù… Ø¹Ù†Ø§ÙˆÙŠÙ† Ø§Ù„Ø£Ù‚Ø³Ø§Ù… ===== */
        .section-title {
            font-size: 1.2rem !important; /* ØªÙ… Ø§Ù„ØªØµØºÙŠØ± Ù…Ù† 1.5rem */
            color: white !important;
            margin-bottom: 12px !important;
            padding-bottom: 8px !important;
            border-bottom: 2px solid !important;
            display: flex !important;
            align-items: center !important;
            gap: 8px !important;
        }
        
        .approved-title {
            border-color: var(--success-green) !important;
        }
        
        .waiting-title {
            border-color: var(--secondary-blue) !important;
        }
        
        .tickets-list {
            flex: 1 !important;
            overflow-y: auto !important;
            padding-right: 5px !important;
        }
        
        /* Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ…Ø±ÙŠØ± Ø§Ù„Ù…Ø®ØµØµ */
        .tickets-list::-webkit-scrollbar {
            width: 5px !important; /* ØªÙ… Ø§Ù„ØªØµØºÙŠØ± Ù…Ù† 6px */
        }
        
        .tickets-list::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05) !important;
            border-radius: 8px !important;
        }
        
        .tickets-list::-webkit-scrollbar-thumb {
            background: rgba(59, 130, 246, 0.4) !important; /* ØªÙ… Ø§Ù„ØªØ®ÙÙŠÙ */
            border-radius: 8px !important;
        }
        
        /* ===== Ø§Ù„ØªØ°ÙƒØ±Ø© ÙÙŠ Ø´Ø§Ø´Ø© Ø§Ù„Ø¹Ø±Ø¶ (Ù…ØµØºØ±Ø©) ===== */
        .display-ticket {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.1), rgba(255, 255, 255, 0.05)) !important;
            border-radius: 12px !important; /* ØªÙ… Ø§Ù„ØªØµØºÙŠØ± Ù…Ù† 15px */
            padding: 12px !important; /* ØªÙ… Ø§Ù„ØªØµØºÙŠØ± Ù…Ù† 15px */
            margin-bottom: 10px !important; /* ØªÙ… Ø§Ù„ØªØµØºÙŠØ± Ù…Ù† 12px */
            border: 1px solid rgba(255, 255, 255, 0.1) !important;
            backdrop-filter: blur(8px) !important; /* ØªÙ… Ø§Ù„ØªØµØºÙŠØ± Ù…Ù† 10px */
            transition: all 0.3s ease !important;
            animation: fadeIn 0.5s ease-out !important;
        }
        
        .display-ticket:hover {
            transform: translateX(-3px) !important; /* ØªÙ… Ø§Ù„ØªØµØºÙŠØ± Ù…Ù† 5px */
            border-color: rgba(59, 130, 246, 0.3) !important;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.2) !important; /* ØªÙ… Ø§Ù„ØªØµØºÙŠØ± */
        }
        
        .display-ticket.approved {
            background: linear-gradient(135deg, rgba(34, 197, 94, 0.2), rgba(21, 128, 61, 0.15)) !important;
            border-color: rgba(34, 197, 94, 0.3) !important;
        }
        
        /* ===== ØªÙ‚Ù„ÙŠÙ„ Ø­Ø¬Ù… Ø£Ø±Ù‚Ø§Ù… Ø§Ù„ØªØ°Ø§ÙƒØ± ÙÙŠ Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠ ===== */
        .display-ticket-number {
            font-size: 1.8rem !important; /* ØªÙ… Ø§Ù„ØªØµØºÙŠØ± Ù…Ù† 2.5rem */
            font-weight: 900 !important;
            color: white !important;
            text-align: center !important;
            margin-bottom: 8px !important; /* ØªÙ… Ø§Ù„ØªØµØºÙŠØ± Ù…Ù† 10px */
            text-shadow: 0 2px 8px rgba(0, 0, 0, 0.3) !important; /* ØªÙ… Ø§Ù„ØªØµØºÙŠØ± */
        }
        
        .display-ticket-details {
            text-align: center !important;
        }
        
        /* ===== ØªÙ‚Ù„ÙŠÙ„ Ø­Ø¬Ù… Ù†ØµÙˆØµ Ø§Ù„ØªØ°Ø§ÙƒØ± ===== */
        .display-ticket-department {
            font-size: 0.9rem !important; /* ØªÙ… Ø§Ù„ØªØµØºÙŠØ± Ù…Ù† 1rem */
            color: #cbd5e1 !important;
            margin-bottom: 4px !important; /* ØªÙ… Ø§Ù„ØªØµØºÙŠØ± Ù…Ù† 5px */
        }
        
        .display-ticket-office {
            font-size: 0.8rem !important; /* ØªÙ… Ø§Ù„ØªØµØºÙŠØ± Ù…Ù† 0.9rem */
            color: #94a3b8 !important;
        }
        
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(8px); /* ØªÙ… Ø§Ù„ØªØµØºÙŠØ± Ù…Ù† 10px */
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        /* ===== Ø§Ù„ØªØ§ÙŠÙ…Ø± Ø§Ù„Ù…ØªØ­Ø±Ùƒ ===== */
        .news-ticker {
            background: linear-gradient(90deg, rgba(30, 58, 138, 0.9), rgba(59, 130, 246, 0.9)) !important;
            padding: 10px 0 !important; /* ØªÙ… Ø§Ù„ØªØµØºÙŠØ± Ù…Ù† 15px */
            overflow: hidden !important;
            position: relative !important;
            white-space: nowrap !important;
            height: 50px !important;
        }
        
        .ticker-content {
            display: inline-block !important;
            padding-left: 100% !important;
            animation: ticker 40s linear infinite !important;
            font-size: 1rem !important; /* ØªÙ… Ø§Ù„ØªØµØºÙŠØ± Ù…Ù† 1.2rem */
            font-weight: bold !important;
            color: white !important;
        }
        
        @keyframes ticker {
            0% { transform: translateX(0); }
            100% { transform: translateX(-100%); }
        }
        
        /* ===== Ù…Ø¤Ø´Ø± Ø§Ù„ØµÙˆØª ===== */
        .sound-indicator {
            position: fixed !important;
            bottom: 20px !important;
            right: 20px !important;
            background: linear-gradient(135deg, var(--secondary-blue), var(--primary-blue)) !important;
            color: white !important;
            padding: 12px 20px !important; /* ØªÙ… Ø§Ù„ØªØµØºÙŠØ± */
            border-radius: 12px !important; /* ØªÙ… Ø§Ù„ØªØµØºÙŠØ± */
            display: flex !important;
            align-items: center !important;
            gap: 10px !important; /* ØªÙ… Ø§Ù„ØªØµØºÙŠØ± */
            z-index: 9999 !important;
            animation: slideIn 0.3s ease !important;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3) !important; /* ØªÙ… Ø§Ù„ØªØµØºÙŠØ± */
            backdrop-filter: blur(8px) !important; /* ØªÙ… Ø§Ù„ØªØµØºÙŠØ± */
            border: 1px solid rgba(255, 255, 255, 0.2) !important; /* ØªÙ… Ø§Ù„ØªØµØºÙŠØ± */
        }
        
        .sound-pulse {
            animation: soundPulse 1.5s infinite !important;
        }
        
        @keyframes soundPulse {
            0% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.15); opacity: 0.7; } /* ØªÙ… Ø§Ù„ØªØµØºÙŠØ± Ù…Ù† 1.2 */
            100% { transform: scale(1); opacity: 1; }
        }
        
        @keyframes slideIn {
            from {
                transform: translateY(80px); /* ØªÙ… Ø§Ù„ØªØµØºÙŠØ± Ù…Ù† 100px */
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }
        
        /* ===== Ø£Ø²Ø±Ø§Ø± Ù…Ø­Ø³Ù†Ø© ===== */
        .btn-primary {
            background: linear-gradient(135deg, var(--secondary-blue), var(--primary-blue)) !important;
            color: white !important;
            padding: 10px 20px !important; /* ØªÙ… Ø§Ù„ØªØµØºÙŠØ± */
            border-radius: 8px !important; /* ØªÙ… Ø§Ù„ØªØµØºÙŠØ± */
            font-weight: bold !important;
            border: none !important;
            transition: all 0.3s ease !important;
            box-shadow: 0 3px 12px rgba(59, 130, 246, 0.3) !important; /* ØªÙ… Ø§Ù„ØªØµØºÙŠØ± */
            cursor: pointer !important;
            display: flex !important;
            align-items: center !important;
            justify-content: center !important;
            gap: 6px !important; /* ØªÙ… Ø§Ù„ØªØµØºÙŠØ± */
        }
        
        .btn-primary:hover {
            transform: translateY(-2px) !important;
            box-shadow: 0 5px 15px rgba(59, 130, 246, 0.4) !important; /* ØªÙ… Ø§Ù„ØªØµØºÙŠØ± */
        }
        
        .btn-success {
            background: linear-gradient(135deg, var(--success-green), #34d399) !important;
            color: white !important;
            padding: 8px 16px !important; /* ØªÙ… Ø§Ù„ØªØµØºÙŠØ± */
            border-radius: 6px !important; /* ØªÙ… Ø§Ù„ØªØµØºÙŠØ± */
            font-weight: bold !important;
            border: none !important;
            transition: all 0.3s ease !important;
            cursor: pointer !important;
        }
        
        .btn-danger {
            background: linear-gradient(135deg, var(--danger-red), #f87171) !important;
            color: white !important;
            padding: 8px 16px !important; /* ØªÙ… Ø§Ù„ØªØµØºÙŠØ± */
            border-radius: 6px !important; /* ØªÙ… Ø§Ù„ØªØµØºÙŠØ± */
            font-weight: bold !important;
            border: none !important;
            transition: all 0.3s ease !important;
            cursor: pointer !important;
        }
        
        .btn-warning {
            background: linear-gradient(135deg, var(--warning-orange), #fbbf24) !important;
            color: white !important;
            padding: 8px 16px !important;
            border-radius: 6px !important;
            font-weight: bold !important;
            border: none !important;
            transition: all 0.3s ease !important;
            cursor: pointer !important;
        }
        
        /* ===== Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª ===== */
        .card {
            background: white !important;
            border-radius: 12px !important; /* ØªÙ… Ø§Ù„ØªØµØºÙŠØ± Ù…Ù† 15px */
            padding: 16px !important; /* ØªÙ… Ø§Ù„ØªØµØºÙŠØ± Ù…Ù† 20px */
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.08) !important; /* ØªÙ… Ø§Ù„ØªØµØºÙŠØ± */
            border: 1px solid #e5e7eb !important;
            transition: transform 0.3s ease, box-shadow 0.3s ease !important;
        }
        
        .card:hover {
            transform: translateY(-3px) !important; /* ØªÙ… Ø§Ù„ØªØµØºÙŠØ± Ù…Ù† 5px */
            box-shadow: 0 12px 30px rgba(0, 0, 0, 0.12) !important; /* ØªÙ… Ø§Ù„ØªØµØºÙŠØ± */
        }
        
        /* ===== Ø§Ù„Ø´Ø¹Ø§Ø± ===== */
        .logo-container {
            width: 80px !important; /* ØªÙ… Ø§Ù„ØªØµØºÙŠØ± Ù…Ù† 100px */
            height: 80px !important; /* ØªÙ… Ø§Ù„ØªØµØºÙŠØ± Ù…Ù† 100px */
            border-radius: 50% !important;
            overflow: hidden !important;
            border: 2px solid white !important; /* ØªÙ… Ø§Ù„ØªØµØºÙŠØ± Ù…Ù† 3px */
            box-shadow: 0 0 15px rgba(59, 130, 246, 0.5) !important; /* ØªÙ… Ø§Ù„ØªØµØºÙŠØ± */
            background: white !important;
            display: flex !important;
            align-items: center !important;
            justify-content: center !important;
        }
        
        .logo-container img {
            width: 85% !important; /* ØªÙ… Ø§Ù„ØªØµØºÙŠØ± Ù…Ù† 90% */
            height: 85% !important; /* ØªÙ… Ø§Ù„ØªØµØºÙŠØ± Ù…Ù† 90% */
            object-fit: contain !important;
        }
        
        /* ===== Ø­Ø§Ù„Ø© Ø§Ù„Ø§ØªØµØ§Ù„ ===== */
        .connection-status {
            position: fixed !important;
            top: 8px !important; /* ØªÙ… Ø§Ù„ØªØµØºÙŠØ± Ù…Ù† 10px */
            right: 8px !important; /* ØªÙ… Ø§Ù„ØªØµØºÙŠØ± Ù…Ù† 10px */
            z-index: 1000 !important;
            padding: 6px 12px !important; /* ØªÙ… Ø§Ù„ØªØµØºÙŠØ± */
            border-radius: 16px !important; /* ØªÙ… Ø§Ù„ØªØµØºÙŠØ± Ù…Ù† 20px */
            font-size: 11px !important; /* ØªÙ… Ø§Ù„ØªØµØºÙŠØ± Ù…Ù† 12px */
            font-weight: bold !important;
            display: flex !important;
            align-items: center !important;
            gap: 4px !important; /* ØªÙ… Ø§Ù„ØªØµØºÙŠØ± Ù…Ù† 6px */
            animation: slideIn 0.3s ease !important;
        }
        
        .connection-status.connected {
            background: rgba(34, 197, 94, 0.1) !important;
            color: #16a34a !important;
            border: 1px solid #86efac !important;
        }
        
        .connection-status.disconnected {
            background: rgba(239, 68, 68, 0.1) !important;
            color: #dc2626 !important;
            border: 1px solid #fca5a5 !important;
        }
        
        /* ===== Ø´Ø±ÙŠØ· Ø§Ù„ØªØ­Ù…ÙŠÙ„ ===== */
        .loading-spinner {
            border: 3px solid #f3f3f3 !important; /* ØªÙ… Ø§Ù„ØªØµØºÙŠØ± Ù…Ù† 4px */
            border-top: 3px solid #3b82f6 !important; /* ØªÙ… Ø§Ù„ØªØµØºÙŠØ± Ù…Ù† 4px */
            border-radius: 50% !important;
            width: 32px !important; /* ØªÙ… Ø§Ù„ØªØµØºÙŠØ± Ù…Ù† 40px */
            height: 32px !important; /* ØªÙ… Ø§Ù„ØªØµØºÙŠØ± Ù…Ù† 40px */
            animation: spin 1s linear infinite !important;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* ===== Ø¥Ø®ÙØ§Ø¡ Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ…Ø±ÙŠØ± Ù…Ø¹ Ø§Ù„Ø§Ø­ØªÙØ§Ø¸ Ø¨Ø§Ù„Ù‚Ø¯Ø±Ø© Ø¹Ù„Ù‰ Ø§Ù„ØªÙ…Ø±ÙŠØ± ===== */
        .scrollable-content {
            overflow-y: auto !important;
            scrollbar-width: thin !important;
            scrollbar-color: rgba(59, 130, 246, 0.4) rgba(0, 0, 0, 0.1) !important; /* ØªÙ… Ø§Ù„ØªØ®ÙÙŠÙ */
        }
        
        .scrollable-content::-webkit-scrollbar {
            width: 5px !important; /* ØªÙ… Ø§Ù„ØªØµØºÙŠØ± Ù…Ù† 6px */
        }
        
        .scrollable-content::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.1) !important;
            border-radius: 8px !important; /* ØªÙ… Ø§Ù„ØªØµØºÙŠØ± Ù…Ù† 10px */
        }
        
        .scrollable-content::-webkit-scrollbar-thumb {
            background: rgba(59, 130, 246, 0.4) !important; /* ØªÙ… Ø§Ù„ØªØ®ÙÙŠÙ */
            border-radius: 8px !important; /* ØªÙ… Ø§Ù„ØªØµØºÙŠØ± Ù…Ù† 10px */
        }
        
        /* ===== Ø¥Ø¶Ø§ÙØ§Øª Ø¬Ø¯ÙŠØ¯Ø© ===== */
        .work-hours-notice {
            background: linear-gradient(135deg, #fef3c7, #fde68a) !important;
            border: 1px solid #fbbf24 !important;
            color: #92400e !important;
            padding: 12px 16px !important;
            border-radius: 8px !important;
            margin-bottom: 16px !important;
        }
        
        .appointment-modal {
            animation: slideUp 0.3s ease-out !important;
        }
        
        .calendar-input {
            padding: 12px !important;
            border: 2px solid #e5e7eb !important;
            border-radius: 8px !important;
            width: 100% !important;
            text-align: center !important;
            font-family: 'Cairo', sans-serif !important;
        }
        
        .calendar-input:focus {
            border-color: #3b82f6 !important;
            outline: none !important;
        }
        
        .time-slots {
            display: grid !important;
            grid-template-columns: repeat(4, 1fr) !important;
            gap: 8px !important;
            margin-top: 12px !important;
        }
        
        .time-slot {
            padding: 10px !important;
            border: 1px solid #e5e7eb !important;
            border-radius: 6px !important;
            text-align: center !important;
            cursor: pointer !important;
            transition: all 0.2s !important;
        }
        
        .time-slot:hover {
            border-color: #3b82f6 !important;
            background: #eff6ff !important;
        }
        
        .time-slot.selected {
            background: #3b82f6 !important;
            color: white !important;
            border-color: #3b82f6 !important;
        }
        
        .time-slot.disabled {
            background: #f3f4f6 !important;
            color: #9ca3af !important;
            cursor: not-allowed !important;
        }
        
        .delete-confirmation {
            animation: shake 0.5s ease-in-out !important;
        }
        
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
            20%, 40%, 60%, 80% { transform: translateX(5px); }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        // === ØªÙ‡ÙŠØ¦Ø© Firebase ===
        const firebaseConfig = {
            apiKey: "AIzaSyA2WwSnB54y4Xf3p_WPFHeSf7QOGgi3rS8",
            authDomain: "zahrani-4bbf3.firebaseapp.com",
            databaseURL: "https://zahrani-4bbf3-default-rtdb.firebaseio.com",
            projectId: "zahrani-4bbf3",
            storageBucket: "zahrani-4bbf3.firebasestorage.app",
            messagingSenderId: "76127187270",
            appId: "1:76127187270:web:c0d8869fc61275da5ab547"
        };

        try {
            firebase.initializeApp(firebaseConfig);
            console.log("âœ… Firebase initialized successfully");
        } catch (error) {
            console.log("âš ï¸ Firebase already initialized:", error);
        }

        const db = firebase.firestore();
        const realtimeDB = firebase.database();
        const auth = firebase.auth();

        // === Ù†Ø¸Ø§Ù… Ø§Ù„ØµÙˆØª Ø§Ù„Ù…Ø­Ø³Ù† ===
        class EnhancedSoundManager {
            constructor() {
                this.speechSynthesis = window.speechSynthesis;
                this.isSpeaking = false;
                this.voices = [];
                this.loadVoices();
            }

            loadVoices() {
                if (this.speechSynthesis) {
                    const getVoices = () => {
                        this.voices = this.speechSynthesis.getVoices();
                        console.log('ğŸ¤ Available voices:', this.voices.length);
                    };
                    
                    getVoices();
                    this.speechSynthesis.onvoiceschanged = getVoices;
                }
            }

            speak(text, lang = 'ar-SA') {
                if (!this.speechSynthesis) {
                    console.warn('âš ï¸ Speech synthesis not supported');
                    return null;
                }

                this.speechSynthesis.cancel();
                
                const utterance = new SpeechSynthesisUtterance(text);
                utterance.lang = lang;
                
                if (lang.startsWith('ar')) {
                    utterance.rate = 0.85;
                    utterance.pitch = 1.0;
                    utterance.volume = 1.0;
                    
                    const arabicVoice = this.voices.find(voice => 
                        voice.lang.startsWith('ar') || 
                        voice.name.toLowerCase().includes('arabic')
                    );
                    if (arabicVoice) {
                        utterance.voice = arabicVoice;
                    }
                } else {
                    utterance.rate = 0.9;
                    utterance.pitch = 1.0;
                    utterance.volume = 1.0;
                    
                    const englishVoice = this.voices.find(voice => 
                        voice.lang.startsWith('en') || 
                        voice.name.toLowerCase().includes('english')
                    );
                    if (englishVoice) {
                        utterance.voice = englishVoice;
                    }
                }
                
                this.speechSynthesis.speak(utterance);
                this.isSpeaking = true;
                
                utterance.onend = () => {
                    this.isSpeaking = false;
                };
                
                utterance.onerror = (event) => {
                    console.error('âŒ Speech synthesis error:', event);
                    this.isSpeaking = false;
                };
                
                return utterance;
            }

            announceTicket(ticketNumber, roomAr, roomEn) {
                const arabicText = `Ø§Ù„ØªØ°ÙƒØ±Ø© Ø±Ù‚Ù… ${ticketNumber}ØŒ ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªÙˆØ¬Ù‡ Ø¥Ù„Ù‰ ${roomAr}`;
                const englishText = `Ticket number ${ticketNumber}, please proceed to ${roomEn}`;
                
                console.log('ğŸ”Š Playing announcement:', { ticketNumber, roomAr, roomEn });
                
                // Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø´Ø¹Ø§Ø± ØµÙˆØªÙŠ Ø¥Ù„Ù‰ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù„ÙŠØªÙ… ØªØ´ØºÙŠÙ„Ù‡ Ø¹Ù„Ù‰ Ø§Ù„Ø´Ø§Ø´Ø©
                realtimeDB.ref('audioAnnouncements').push({
                    ticketNumber,
                    roomAr,
                    roomEn,
                    timestamp: Date.now()
                });
                
                // ØªØ´ØºÙŠÙ„ Ø§Ù„ØµÙˆØª Ù…Ø­Ù„ÙŠØ§Ù‹ ÙÙ‚Ø· Ø¥Ø°Ø§ ÙƒÙ†Ø§ ÙÙŠ Ø´Ø§Ø´Ø© Ø§Ù„Ø¹Ø±Ø¶
                const urlParams = new URLSearchParams(window.location.search);
                const isDisplayScreen = urlParams.get('view') === 'display';
                
                if (isDisplayScreen) {
                    console.log('ğŸ”Š Display screen detected, playing audio locally');
                    const arUtterance = this.speak(arabicText, 'ar-SA');
                    
                    if (arUtterance) {
                        arUtterance.onend = () => {
                            setTimeout(() => {
                                this.speak(englishText, 'en-US');
                            }, 1000);
                        };
                    }
                } else {
                    console.log('ğŸ”Š Not a display screen, audio will be played on display screen');
                }
                
                return true;
            }

            stop() {
                if (this.speechSynthesis) {
                    this.speechSynthesis.cancel();
                    this.isSpeaking = false;
                }
            }
        }

        const soundManager = new EnhancedSoundManager();

        // === Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù… ===
        const CONFIG = {
            companyName: {
                ar: "Ø§Ù„Ø²Ù‡Ø±Ø§Ù†ÙŠ Ù„Ù„Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ù„ÙˆØ¬Ø³ØªÙŠØ©",
                en: "Al-Zahrani Logistics Services"
            },
            systemName: {
                ar: "Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø·ÙˆØ§Ø¨ÙŠØ± Ø§Ù„Ø°ÙƒÙŠ",
                en: "Smart Queue Management System"
            },
            adminCode: "0906212",
            maxTicketNumber: 10000,
            
            // Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø§Ù„Ø¹Ù…Ù„
            workHours: {
                start: 10, // 10 ØµØ¨Ø§Ø­Ø§Ù‹
                end: 18,   // 6 Ù…Ø³Ø§Ø¡Ù‹
                days: [0, 1, 2, 3, 4, 5], // Ø§Ù„Ø³Ø¨Øª Ø¥Ù„Ù‰ Ø§Ù„Ø®Ù…ÙŠØ³ (0=Ø§Ù„Ø£Ø­Ø¯ØŒ 1=Ø§Ù„Ø¥Ø«Ù†ÙŠÙ†ØŒ ...ØŒ 6=Ø§Ù„Ø³Ø¨Øª)
                messageAr: "Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø§Ù„Ø¹Ù…Ù„: Ù…Ù† 10 ØµØ¨Ø§Ø­Ø§Ù‹ Ø¥Ù„Ù‰ 6 Ù…Ø³Ø§Ø¡Ø§Ù‹ | Ø£ÙŠØ§Ù… Ø§Ù„Ø¹Ù…Ù„: Ù…Ù† Ø§Ù„Ø³Ø¨Øª Ø¥Ù„Ù‰ Ø§Ù„Ø®Ù…ÙŠØ³",
                messageEn: "Working hours: 10 AM to 6 PM | Working days: Saturday to Thursday"
            },
            
            departments: [
                { 
                    id: 'vehicles', 
                    nameAr: "Ù‚Ø³Ù… Ø§Ù„Ù…Ø±ÙƒØ¨Ø§Øª", 
                    nameEn: "Vehicles Department",
                    prefix: "V", 
                    roomAr: "Ù…ÙƒØªØ¨ Ø§Ù„Ù…Ø±ÙƒØ¨Ø§Øª", 
                    roomEn: "Vehicles Office", 
                    color: "#3b82f6",
                    icon: "fa-solid fa-truck",
                    iconColor: "#1d4ed8",
                    categoryAr: "ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ø±ÙƒØ¨Ø§Øª",
                    categoryEn: "Vehicle Modification"
                },
                { 
                    id: 'finance', 
                    nameAr: "Ù‚Ø³Ù… Ø§Ù„Ù…Ø§Ù„ÙŠØ©", 
                    nameEn: "Finance Department",
                    prefix: "F", 
                    roomAr: "Ù…ÙƒØªØ¨ Ø§Ù„Ù…Ø¯ÙŠØ± Ø§Ù„Ù…Ø§Ù„ÙŠ", 
                    roomEn: "Finance Office", 
                    color: "#10b981",
                    icon: "fa-solid fa-money-bill-wave",
                    iconColor: "#047857",
                    categoryAr: "Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø§Ù„ÙŠØ©",
                    categoryEn: "Financial Management"
                },
                { 
                    id: 'supervisors', 
                    nameAr: "Ù…Ø¯ÙŠØ± Ø§Ù„ØªØ´ØºÙŠÙ„", 
                    nameEn: "Supervisors Department",
                    prefix: "S", 
                    roomAr: "Ù…ÙƒØªØ¨ Ù…Ø¯ÙŠØ± Ø§Ù„ØªØ´ØºÙŠÙ„", 
                    roomEn: "Supervisors Office", 
                    color: "#8b5cf6",
                    icon: "fa-solid fa-user-tie",
                    iconColor: "#7c3aed",
                    categoryAr: "Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª",
                    categoryEn: "Operations Management"
                },
                { 
                    id: 'hr', 
                    nameAr: "Ø§Ù„Ù…ÙˆØ§Ø±Ø¯ Ø§Ù„Ø¨Ø´Ø±ÙŠØ©", 
                    nameEn: "Human Resources",
                    prefix: "HR", 
                    roomAr: "Ù…ÙƒØªØ¨ Ø§Ù„Ù…ÙˆØ§Ø±Ø¯ Ø§Ù„Ø¨Ø´Ø±ÙŠØ©", 
                    roomEn: "HR Office", 
                    color: "#ef4444",
                    icon: "fa-solid fa-users",
                    iconColor: "#dc2626",
                    categoryAr: "Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ÙˆØ§Ø±Ø¯ Ø§Ù„Ø¨Ø´Ø±ÙŠØ©",
                    categoryEn: "Human Resources Management"
                },
                { 
                    id: 'petroleum', 
                    nameAr: "Ù‚Ø³Ù… Ø§Ù„Ø¨ØªØ±ÙˆÙ„", 
                    nameEn: "Petroleum Department",
                    prefix: "P", 
                    roomAr: "Ù…ÙƒØªØ¨ Ø§Ù„Ø¨ØªØ±ÙˆÙ„", 
                    roomEn: "Petroleum Office", 
                    color: "#06b6d4",
                    icon: "fa-solid fa-gas-pump",
                    iconColor: "#0891b2",
                    categoryAr: "Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¨ØªØ±ÙˆÙ„",
                    categoryEn: "Petroleum Management"
                },
                // Ø§Ù„Ø£Ù‚Ø³Ø§Ù… Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
                { 
                    id: 'ninja_firstcry', 
                    nameAr: "Ù…Ø¯ÙŠØ± ØªØ´ØºÙŠÙ„ Ù†ÙŠÙ†Ø¬Ø§ ÙˆÙØ±Ø³Øª ÙƒØ±Ø§ÙŠ", 
                    nameEn: "Ninja & FirstCry Operations Manager",
                    prefix: "NF", 
                    roomAr: "Ù…ÙƒØªØ¨ Ù…Ø¯ÙŠØ± ØªØ´ØºÙŠÙ„ Ù†ÙŠÙ†Ø¬Ø§ ÙˆÙØ±Ø³Øª ÙƒØ±Ø§ÙŠ", 
                    roomEn: "Ninja & FirstCry Operations Office", 
                    color: "#8b5cf6",
                    icon: "fa-solid fa-shield-alt",
                    iconColor: "#7c3aed",
                    categoryAr: "Ø¥Ø¯Ø§Ø±Ø© ØªØ´ØºÙŠÙ„ Ù†ÙŠÙ†Ø¬Ø§ ÙˆÙØ±Ø³Øª ÙƒØ±Ø§ÙŠ",
                    categoryEn: "Ninja & FirstCry Operations Management"
                },
                { 
                    id: 'naqel_flow', 
                    nameAr: "Ù…Ø¯ÙŠØ± ØªØ´ØºÙŠÙ„ Ù†Ø§Ù‚Ù„ ÙˆÙÙ„Ùˆ", 
                    nameEn: "Naqel & Flow Operations Manager",
                    prefix: "NL", 
                    roomAr: "Ù…ÙƒØªØ¨ Ù…Ø¯ÙŠØ± ØªØ´ØºÙŠÙ„ Ù†Ø§Ù‚Ù„ ÙˆÙÙ„Ùˆ", 
                    roomEn: "Naqel & Flow Operations Office", 
                    color: "#f59e0b",
                    icon: "fa-solid fa-shipping-fast",
                    iconColor: "#d97706",
                    categoryAr: "Ø¥Ø¯Ø§Ø±Ø© ØªØ´ØºÙŠÙ„ Ù†Ø§Ù‚Ù„ ÙˆÙÙ„Ùˆ",
                    categoryEn: "Naqel & Flow Operations Management"
                }
            ]
        };

        // === Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù„ØºØ§Øª ===
        const LANGUAGES = {
            ar: {
                welcome: "Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨ÙƒÙ… ÙÙŠ Ø´Ø±ÙƒØ© Ø§Ù„Ø²Ù‡Ø±Ø§Ù†ÙŠ Ù„Ù„Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ù„ÙˆØ¬Ø³ØªÙŠØ©",
                selectDept: "Ø§Ø®ØªØ± Ø§Ù„Ù‚Ø³Ù… Ø§Ù„Ù…Ù†Ø§Ø³Ø¨ Ù„Ø®Ø¯Ù…ØªÙƒÙ…",
                instructions: "ØªØ¹Ù„ÙŠÙ…Ø§Øª Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…",
                instruction1: "Ø§Ø®ØªØ± Ø§Ù„Ù‚Ø³Ù… Ø§Ù„Ù…Ù†Ø§Ø³Ø¨ Ù„Ø®Ø¯Ù…ØªÙƒ",
                instruction2: "Ø§Ø­ÙØ¸ Ø±Ù‚Ù… Ø§Ù„ØªØ°ÙƒØ±Ø© Ø§Ù„Ù…Ø¹Ø±ÙˆØ¶",
                instruction3: "Ø§Ø¬Ù„Ø³ ÙÙŠ Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±",
                instruction4: "Ø§Ù†ØªØ¸Ø± Ø­ØªÙ‰ Ø¸Ù‡ÙˆØ± Ø±Ù‚Ù…Ùƒ Ø¹Ù„Ù‰ Ø§Ù„Ø´Ø§Ø´Ø©",
                instruction5: "ØªÙˆØ¬Ù‡ Ø¥Ù„Ù‰ Ø§Ù„Ù…ÙƒØªØ¨ Ø§Ù„Ù…Ø­Ø¯Ø¯ Ø¹Ù†Ø¯ Ø§Ù„Ù†Ø¯Ø§Ø¡",
                lastNumber: "Ø¢Ø®Ø± Ø±Ù‚Ù…",
                waiting: "ÙÙŠ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±",
                currentCall: "Ø§Ù„Ù†Ø¯Ø§Ø¡ Ø§Ù„Ø­Ø§Ù„ÙŠ",
                waitingService: "Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ø®Ø¯Ù…Ø©...",
                pleaseWait: "ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø¬Ù„ÙˆØ³ ÙˆØ§Ù„Ù…ØªØ§Ø¨Ø¹Ø©",
                recentCalls: "Ø§Ù„Ø³Ø¬Ù„ Ø§Ù„Ø­Ø§Ù„ÙŠ",
                ticketGenerated: "ØªÙ… Ø§Ø³ØªØ®Ø±Ø§Ø¬ ØªØ°ÙƒØ±ØªÙƒ!",
                waitForCall: "ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø± Ø­ØªÙ‰ Ù†Ø¯Ø§Ø¡ Ø±Ù‚Ù…Ùƒ",
                employeeLogin: "Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†",
                enterCode: "Ø£Ø¯Ø®Ù„ ÙƒÙˆØ¯ Ø§Ù„Ø¯Ø®ÙˆÙ„",
                controlPanel: "Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†",
                selectDeptControl: "Ø§Ø®ØªØ± Ø§Ù„Ù‚Ø³Ù… Ù„Ù„ØªØ­ÙƒÙ… ÙÙŠ Ø§Ù„ØªØ°Ø§ÙƒØ±",
                waitingList: "Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±",
                calledTickets: "Ø§Ù„Ù…Ù†Ø¯Ø§Ø¡ Ø¹Ù„ÙŠÙ‡Ù…",
                recall: "Ø¥Ø¹Ø§Ø¯Ø© Ù†Ø¯Ø§Ø¡",
                finish: "Ø¥Ù†Ù‡Ø§Ø¡",
                delete: "Ø­Ø°Ù",
                deleteTicket: "Ø­Ø°Ù Ø§Ù„ØªØ°ÙƒØ±Ø©",
                deleteConfirm: "Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ù‡ Ø§Ù„ØªØ°ÙƒØ±Ø©ØŸ",
                confirmDelete: "ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø­Ø°Ù",
                cancel: "Ø¥Ù„ØºØ§Ø¡",
                ticketDeleted: "ØªÙ… Ø­Ø°Ù Ø§Ù„ØªØ°ÙƒØ±Ø© Ø¨Ù†Ø¬Ø§Ø­",
                call: "Ù†Ø¯Ø§Ø¡",
                goBack: "Ø§Ù„Ø¹ÙˆØ¯Ø©",
                returnToKiosk: "Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„ÙƒØ´Ùƒ",
                openDisplay: "ÙØªØ­ Ø´Ø§Ø´Ø© Ø§Ù„Ø¹Ø±Ø¶",
                welcomeMessage: "Ø´Ø±ÙƒØ© Ø§Ù„Ø²Ù‡Ø±Ø§Ù†ÙŠ Ù„Ù„Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ù„ÙˆØ¬Ø³ØªÙŠØ© ØªØ±Ø­Ø¨ Ø¨ÙƒÙ… .. ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø± Ø­ØªÙ‰ Ø¸Ù‡ÙˆØ± Ø±Ù‚Ù… ØªØ°ÙƒØ±ØªÙƒÙ…",
                systemMessage: "Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø·Ø§Ø¨ÙˆØ± Ø§Ù„Ø°ÙƒÙŠ Ù¢Ù Ù¢Ù¥",
                holdTicket: "ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø§Ø­ØªÙØ§Ø¸ Ø¨Ø±Ù‚Ù… Ø§Ù„ØªØ°ÙƒØ±Ø© ÙˆØ§Ù„Ù…ØªØ§Ø¨Ø¹Ø©",
                allRights: "Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø©",
                techSupport: "Ø±Ù‚Ù… Ø§Ù„Ø¯Ø¹Ù… Ø§Ù„ÙÙ†ÙŠ",
                visitorKiosk: "ÙƒØ´Ùƒ Ø§Ù„Ø²ÙˆØ§Ø±",
                adminPanel: "Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…",
                displayScreen: "Ø´Ø§Ø´Ø© Ø§Ù„Ø¹Ø±Ø¶",
                generatingTicket: "Ø¬Ø§Ø±Ù ØªÙˆÙ„ÙŠØ¯ Ø§Ù„ØªØ°ÙƒØ±Ø©...",
                connectionStatus: "Ø­Ø§Ù„Ø© Ø§Ù„Ø§ØªØµØ§Ù„",
                connected: "Ù…ØªØµÙ„",
                disconnected: "ØºÙŠØ± Ù…ØªØµÙ„",
                reconnect: "Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø§ØªØµØ§Ù„",
                ticketNumber: "Ø±Ù‚Ù… Ø§Ù„ØªØ°ÙƒØ±Ø©",
                department: "Ø§Ù„Ù‚Ø³Ù…",
                generateTicket: "ØªÙˆÙ„ÙŠØ¯ ØªØ°ÙƒØ±Ø©",
                waitingForService: "Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ø®Ø¯Ù…Ø©",
                proceedTo: "ØªÙˆØ¬Ù‡ Ø¥Ù„Ù‰",
                soundAnnouncementAr: "Ø¬Ø§Ø±ÙŠ Ø§Ù„Ù†Ø¯Ø§Ø¡ Ø¨Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©",
                soundAnnouncementEn: "Ø¬Ø§Ø±ÙŠ Ø§Ù„Ù†Ø¯Ø§Ø¡ Ø¨Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©",
                waitingTickets: "Ø§Ù„ØªØ°Ø§ÙƒØ± Ø§Ù„Ù…Ù†ØªØ¸Ø±Ø©",
                approvedTickets: "Ø§Ù„ØªØ°Ø§ÙƒØ± Ø§Ù„Ù…Ø¹ØªÙ…Ø¯Ø©",
                ticketStatus: "Ø­Ø§Ù„Ø© Ø§Ù„ØªØ°ÙƒØ±Ø©",
                category: "Ø§Ù„ØªØµÙ†ÙŠÙ",
                office: "Ø§Ù„Ù…ÙƒØªØ¨",
                ticketQueue: "Ø·Ø§Ø¨ÙˆØ± Ø§Ù„ØªØ°Ø§ÙƒØ±",
                nextTicket: "Ø§Ù„ØªØ°ÙƒØ±Ø© Ø§Ù„ØªØ§Ù„ÙŠØ©",
                yourTurn: "Ø¯ÙˆØ±Ùƒ Ø§Ù„Ø¢Ù†",
                pleaseProceed: "ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªÙˆØ¬Ù‡ Ø¥Ù„Ù‰",
                systemReady: "Ø§Ù„Ù†Ø¸Ø§Ù… Ø¬Ø§Ù‡Ø² Ù„Ù„Ø®Ø¯Ù…Ø©",
                waitingForApproval: "Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø©",
                approved: "Ù…Ø¹ØªÙ…Ø¯",
                inProgress: "Ù‚ÙŠØ¯ Ø§Ù„ØªÙ†ÙÙŠØ°",
                processing: "Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©",
                bookAppointment: "Ø­Ø¬Ø² Ù…ÙˆØ¹Ø¯ Ø£ÙˆÙ†Ù„Ø§ÙŠÙ†",
                selectDate: "Ø§Ø®ØªØ± Ø§Ù„ØªØ§Ø±ÙŠØ®",
                selectTime: "Ø§Ø®ØªØ± Ø§Ù„ÙˆÙ‚Øª",
                appointmentDate: "ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙˆØ¹Ø¯",
                appointmentTime: "ÙˆÙ‚Øª Ø§Ù„Ù…ÙˆØ¹Ø¯",
                confirmAppointment: "ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø­Ø¬Ø²",
                appointmentBooked: "ØªÙ… Ø­Ø¬Ø² Ø§Ù„Ù…ÙˆØ¹Ø¯ Ø¨Ù†Ø¬Ø§Ø­",
                workHours: "Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø§Ù„Ø¹Ù…Ù„",
                workingDays: "Ø£ÙŠØ§Ù… Ø§Ù„Ø¹Ù…Ù„",
                from: "Ù…Ù†",
                to: "Ø¥Ù„Ù‰",
                onlineAppointment: "Ø­Ø¬Ø² Ù…ÙˆØ¹Ø¯",
                availableSlots: "Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø§Ù„Ù…ØªØ§Ø­Ø©",
                noAvailableSlots: "Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…ÙˆØ§Ø¹ÙŠØ¯ Ù…ØªØ§Ø­Ø©",
                appointmentInstructions: "Ø¨Ø±Ø¬Ø§Ø¡ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ØªØ§Ø±ÙŠØ® ÙˆØ§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…Ù†Ø§Ø³Ø¨ÙŠÙ† Ù„Ø­Ø¬Ø² Ù…ÙˆØ¹Ø¯Ùƒ",
                appointmentSuccess: "ØªÙ… Ø­Ø¬Ø² Ù…ÙˆØ¹Ø¯Ùƒ Ø¨Ù†Ø¬Ø§Ø­",
                appointmentNumber: "Ø±Ù‚Ù… Ø§Ù„Ù…ÙˆØ¹Ø¯",
                appointmentDetails: "ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…ÙˆØ¹Ø¯",
                appointmentNote: "ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø­Ø¶ÙˆØ± Ù‚Ø¨Ù„ Ø§Ù„Ù…ÙˆØ¹Ø¯ Ø¨Ù€ 10 Ø¯Ù‚Ø§Ø¦Ù‚"
            },
            en: {
                welcome: "Welcome to Al-Zahrani Logistics Services",
                selectDept: "Select the appropriate department",
                instructions: "Usage Instructions",
                instruction1: "Select the appropriate department",
                instruction2: "Save the displayed ticket number",
                instruction3: "Sit in the waiting area",
                instruction4: "Wait for your number to appear on screen",
                instruction5: "Proceed to the specified office when called",
                lastNumber: "Last Number",
                waiting: "Waiting",
                currentCall: "Current Call",
                waitingService: "Waiting for service...",
                pleaseWait: "Please sit and follow up",
                recentCalls: "Recent Calls",
                ticketGenerated: "Your ticket has been generated!",
                waitForCall: "Please wait for your number to be called",
                employeeLogin: "Employee Login",
                enterCode: "Enter access code",
                controlPanel: "Employee Control Panel",
                selectDeptControl: "Select department to control tickets",
                waitingList: "Waiting List",
                calledTickets: "Called Tickets",
                recall: "Recall",
                finish: "Finish",
                delete: "Delete",
                deleteTicket: "Delete Ticket",
                deleteConfirm: "Are you sure you want to delete this ticket?",
                confirmDelete: "Confirm Delete",
                cancel: "Cancel",
                ticketDeleted: "Ticket deleted successfully",
                call: "Call",
                goBack: "Go Back",
                returnToKiosk: "Return to Kiosk",
                openDisplay: "Open Display Screen",
                welcomeMessage: "Al-Zahrani Logistics Services welcomes you",
                systemMessage: "Smart Queue Management System 2025",
                holdTicket: "Please keep your ticket number",
                allRights: "All rights reserved",
                techSupport: "Technical Support",
                visitorKiosk: "Visitor Kiosk",
                adminPanel: "Control Panel",
                displayScreen: "Display Screen",
                generatingTicket: "Generating ticket...",
                connectionStatus: "Connection Status",
                connected: "Connected",
                disconnected: "Disconnected",
                reconnect: "Reconnect",
                ticketNumber: "Ticket Number",
                department: "Department",
                generateTicket: "Generate Ticket",
                waitingForService: "Waiting for service",
                proceedTo: "Proceed to",
                soundAnnouncementAr: "Arabic announcement in progress",
                soundAnnouncementEn: "English announcement in progress",
                waitingTickets: "Waiting Tickets",
                approvedTickets: "Approved Tickets",
                ticketStatus: "Ticket Status",
                category: "Category",
                office: "Office",
                ticketQueue: "Ticket Queue",
                nextTicket: "Next Ticket",
                yourTurn: "Your Turn Now",
                pleaseProceed: "Please proceed to",
                systemReady: "System Ready for Service",
                waitingForApproval: "Waiting for Approval",
                approved: "Approved",
                inProgress: "In Progress",
                processing: "Processing",
                bookAppointment: "Book Online Appointment",
                selectDate: "Select Date",
                selectTime: "Select Time",
                appointmentDate: "Appointment Date",
                appointmentTime: "Appointment Time",
                confirmAppointment: "Confirm Booking",
                appointmentBooked: "Appointment booked successfully",
                workHours: "Working Hours",
                workingDays: "Working Days",
                from: "From",
                to: "To",
                onlineAppointment: "Book Appointment",
                availableSlots: "Available Slots",
                noAvailableSlots: "No available slots",
                appointmentInstructions: "Please select date and time for your appointment",
                appointmentSuccess: "Your appointment has been booked successfully",
                appointmentNumber: "Appointment Number",
                appointmentDetails: "Appointment Details",
                appointmentNote: "Please arrive 10 minutes before your appointment"
            }
        };

        // === Ù…Ø¯ÙŠØ± Ø·Ø§Ø¨ÙˆØ± Firebase ===
        class FirebaseQueueManager {
            static async initializeDepartmentCounters() {
                try {
                    for (const dept of CONFIG.departments) {
                        const counterRef = db.collection('counters').doc(dept.id);
                        const doc = await counterRef.get();
                        
                        if (!doc.exists) {
                            await counterRef.set({
                                lastNumber: 0,
                                updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                            });
                        }
                    }
                    return true;
                } catch (error) {
                    console.error('âŒ Error initializing counters:', error);
                    return false;
                }
            }

            static async getNextTicketNumber(deptId) {
                try {
                    const counterRef = db.collection('counters').doc(deptId);
                    
                    const result = await db.runTransaction(async (transaction) => {
                        const counterDoc = await transaction.get(counterRef);
                        let newNumber = 1;
                        
                        if (counterDoc.exists) {
                            const data = counterDoc.data();
                            newNumber = (data.lastNumber || 0) + 1;
                            if (newNumber > CONFIG.maxTicketNumber) {
                                newNumber = 1;
                            }
                        }
                        
                        transaction.set(counterRef, {
                            lastNumber: newNumber,
                            updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                        }, { merge: true });
                        
                        return newNumber;
                    });
                    
                    return result.toString();
                } catch (error) {
                    console.error('âŒ Error getting ticket number:', error);
                    throw error;
                }
            }

            static async addTicket(ticketData) {
                try {
                    const dept = CONFIG.departments.find(d => d.id === ticketData.deptId);
                    if (!dept) throw new Error('Department not found');
                    
                    const ticketNumber = await this.getNextTicketNumber(ticketData.deptId);
                    
                    const ticket = {
                        ...ticketData,
                        id: `ticket_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,
                        number: ticketNumber,
                        deptPrefix: dept.prefix,
                        displayText: ticketNumber,
                        status: 'waiting',
                        approved: false,
                        createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                        updatedAt: firebase.firestore.FieldValue.serverTimestamp(),
                        departmentNameAr: dept.nameAr,
                        departmentNameEn: dept.nameEn,
                        roomAr: dept.roomAr,
                        roomEn: dept.roomEn,
                        categoryAr: dept.categoryAr,
                        categoryEn: dept.categoryEn
                    };
                    
                    await db.collection('tickets').doc(ticket.id).set(ticket);
                    
                    await realtimeDB.ref(`currentCalls/${dept.id}`).set({
                        ticketId: ticket.id,
                        ticketNumber: ticket.number,
                        calledAt: Date.now()
                    });
                    
                    return ticket;
                } catch (error) {
                    console.error('âŒ Error adding ticket:', error);
                    throw error;
                }
            }

            static async addAppointment(appointmentData) {
                try {
                    const dept = CONFIG.departments.find(d => d.id === appointmentData.deptId);
                    if (!dept) throw new Error('Department not found');
                    
                    const ticketNumber = await this.getNextTicketNumber(appointmentData.deptId);
                    
                    const appointment = {
                        ...appointmentData,
                        id: `appointment_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,
                        number: ticketNumber,
                        deptPrefix: dept.prefix,
                        displayText: ticketNumber,
                        status: 'waiting',
                        approved: false,
                        type: 'appointment',
                        appointmentDate: appointmentData.appointmentDate,
                        appointmentTime: appointmentData.appointmentTime,
                        createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                        updatedAt: firebase.firestore.FieldValue.serverTimestamp(),
                        departmentNameAr: dept.nameAr,
                        departmentNameEn: dept.nameEn,
                        roomAr: dept.roomAr,
                        roomEn: dept.roomEn,
                        categoryAr: dept.categoryAr,
                        categoryEn: dept.categoryEn
                    };
                    
                    await db.collection('tickets').doc(appointment.id).set(appointment);
                    
                    return appointment;
                } catch (error) {
                    console.error('âŒ Error adding appointment:', error);
                    throw error;
                }
            }

            static async deleteTicket(ticketId) {
                try {
                    await db.collection('tickets').doc(ticketId).delete();
                    
                    await realtimeDB.ref(`ticketUpdates/${ticketId}`).set({
                        action: 'deleted',
                        timestamp: Date.now()
                    });
                    
                    return true;
                } catch (error) {
                    console.error('âŒ Error deleting ticket:', error);
                    throw error;
                }
            }

            static async callTicket(ticketId) {
                try {
                    const ticketRef = db.collection('tickets').doc(ticketId);
                    const ticketDoc = await ticketRef.get();
                    
                    if (!ticketDoc.exists) {
                        throw new Error('Ticket not found');
                    }
                    
                    const ticket = ticketDoc.data();
                    const dept = CONFIG.departments.find(d => d.id === ticket.deptId);
                    
                    await ticketRef.update({
                        status: 'called',
                        calledAt: firebase.firestore.FieldValue.serverTimestamp(),
                        updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                    });
                    
                    await realtimeDB.ref(`currentCalls/${ticket.deptId}`).set({
                        ticketId: ticket.id,
                        ticketNumber: ticket.number,
                        calledAt: Date.now(),
                        departmentNameAr: dept.nameAr,
                        departmentNameEn: dept.nameEn,
                        roomAr: dept.roomAr,
                        roomEn: dept.roomEn,
                        categoryAr: dept.categoryAr,
                        categoryEn: dept.categoryEn
                    });
                    
                    // Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø´Ø¹Ø§Ø± ØµÙˆØªÙŠ Ù„ÙŠØªÙ… ØªØ´ØºÙŠÙ„Ù‡ Ø¹Ù„Ù‰ Ø´Ø§Ø´Ø© Ø§Ù„Ø¹Ø±Ø¶
                    await realtimeDB.ref('audioAnnouncements').push({
                        ticketNumber: ticket.number,
                        roomAr: dept.roomAr,
                        roomEn: dept.roomEn,
                        timestamp: Date.now(),
                        action: 'call'
                    });
                    
                    return ticket;
                } catch (error) {
                    console.error('âŒ Error calling ticket:', error);
                    throw error;
                }
            }

            static async approveTicket(ticketId) {
                try {
                    await db.collection('tickets').doc(ticketId).update({
                        approved: true,
                        approvedAt: firebase.firestore.FieldValue.serverTimestamp(),
                        updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                    });
                    
                    // Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø´Ø¹Ø§Ø± Ø¥Ù„Ù‰ Real-time Database Ù„Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙÙˆØ±ÙŠ
                    await realtimeDB.ref(`ticketUpdates/${ticketId}`).set({
                        action: 'approved',
                        timestamp: Date.now()
                    });
                    
                    return true;
                } catch (error) {
                    console.error('âŒ Error approving ticket:', error);
                    throw error;
                }
            }

            static async finishTicket(ticketId) {
                try {
                    await db.collection('tickets').doc(ticketId).update({
                        status: 'finished',
                        finishedAt: firebase.firestore.FieldValue.serverTimestamp(),
                        updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                    });
                    
                    await realtimeDB.ref(`ticketUpdates/${ticketId}`).set({
                        action: 'finished',
                        timestamp: Date.now()
                    });
                    
                    return true;
                } catch (error) {
                    console.error('âŒ Error finishing ticket:', error);
                    throw error;
                }
            }

            static subscribeToTickets(callback) {
                return db.collection('tickets')
                    .orderBy('createdAt', 'desc')
                    .limit(50)
                    .onSnapshot(snapshot => {
                        const tickets = [];
                        snapshot.forEach(doc => {
                            tickets.push({ id: doc.id, ...doc.data() });
                        });
                        callback(tickets);
                    }, error => {
                        console.error('âŒ Error subscribing to tickets:', error);
                    });
            }

            static subscribeToCurrentCalls(callback) {
                return realtimeDB.ref('currentCalls').on('value', snapshot => {
                    callback(snapshot.val() || {});
                }, error => {
                    console.error('âŒ Error subscribing to current calls:', error);
                });
            }

            static subscribeToTicketUpdates(callback) {
                return realtimeDB.ref('ticketUpdates').on('child_added', snapshot => {
                    callback(snapshot.val());
                }, error => {
                    console.error('âŒ Error subscribing to ticket updates:', error);
                });
            }

            static subscribeToAudioAnnouncements(callback) {
                return realtimeDB.ref('audioAnnouncements').on('child_added', snapshot => {
                    callback(snapshot.val());
                }, error => {
                    console.error('âŒ Error subscribing to audio announcements:', error);
                });
            }

            static async getDepartmentStats(deptId) {
                try {
                    const waitingQuery = await db.collection('tickets')
                        .where('deptId', '==', deptId)
                        .where('status', '==', 'waiting')
                        .get();
                    
                    const calledQuery = await db.collection('tickets')
                        .where('deptId', '==', deptId)
                        .where('status', '==', 'called')
                        .get();
                    
                    const counterDoc = await db.collection('counters').doc(deptId).get();
                    const lastNumber = counterDoc.exists ? counterDoc.data().lastNumber || 0 : 0;
                    
                    return {
                        waitingCount: waitingQuery.size,
                        calledCount: calledQuery.size,
                        lastNumber: lastNumber
                    };
                } catch (error) {
                    console.error('âŒ Error getting department stats:', error);
                    return { waitingCount: 0, calledCount: 0, lastNumber: 0 };
                }
            }

            static async getAllStats() {
                try {
                    const stats = {};
                    for (const dept of CONFIG.departments) {
                        stats[dept.id] = await this.getDepartmentStats(dept.id);
                    }
                    return stats;
                } catch (error) {
                    console.error('âŒ Error getting all stats:', error);
                    return {};
                }
            }
        }

        // === Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ ===
        const { useState, useEffect, useMemo, useRef } = React;

        function App() {
            const [view, setView] = useState('kiosk');
            const [language, setLanguage] = useState('ar');
            const [currentTime, setCurrentTime] = useState(new Date());
            const [isOnline, setIsOnline] = useState(navigator.onLine);
            const [tickets, setTickets] = useState([]);
            const [currentCalls, setCurrentCalls] = useState({});
            const [departmentStats, setDepartmentStats] = useState({});
            const [activeDept, setActiveDept] = useState(null);
            const [successTicket, setSuccessTicket] = useState(null);
            const [adminCode, setAdminCode] = useState('');
            const [showAdminLogin, setShowAdminLogin] = useState(false);
            const [adminError, setAdminError] = useState('');
            const [isGeneratingTicket, setIsGeneratingTicket] = useState(false);
            const [connectionStatus, setConnectionStatus] = useState('connecting');
            const [showSoundIndicator, setShowSoundIndicator] = useState(false);
            const [currentAnnouncementLang, setCurrentAnnouncementLang] = useState('');
            const [isSoundPlaying, setIsSoundPlaying] = useState(false);
            const [ticketUpdates, setTicketUpdates] = useState([]);
            const [audioAnnouncements, setAudioAnnouncements] = useState([]);
            
            // Ø¥Ø¶Ø§ÙØ§Øª Ø¬Ø¯ÙŠØ¯Ø©
            const [ticketToDelete, setTicketToDelete] = useState(null);
            const [showAppointmentModal, setShowAppointmentModal] = useState(false);
            const [selectedDeptForAppointment, setSelectedDeptForAppointment] = useState(null);
            const [appointmentDate, setAppointmentDate] = useState('');
            const [appointmentTime, setAppointmentTime] = useState('');
            const [appointmentSuccess, setAppointmentSuccess] = useState(null);
            const [availableTimeSlots, setAvailableTimeSlots] = useState([]);
            const [isBookingAppointment, setIsBookingAppointment] = useState(false);

            const t = LANGUAGES[language];
            const isRTL = language === 'ar';

            // ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø§Ù„Ù…ØªØ§Ø­Ø©
            const generateTimeSlots = (date) => {
                if (!date) return [];
                
                const slots = [];
                const startHour = CONFIG.workHours.start;
                const endHour = CONFIG.workHours.end;
                
                for (let hour = startHour; hour < endHour; hour++) {
                    slots.push({
                        time: `${hour}:00`,
                        label: `${hour}:00`
                    });
                    slots.push({
                        time: `${hour}:30`,
                        label: `${hour}:30`
                    });
                }
                
                return slots;
            };

            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¹Ù…Ù„
            const isWorkingDay = (date) => {
                const day = date.getDay();
                return CONFIG.workHours.days.includes(day);
            };

            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø§Ù„Ø¹Ù…Ù„
            const isValidWorkingTime = (time) => {
                const hour = parseInt(time.split(':')[0]);
                return hour >= CONFIG.workHours.start && hour < CONFIG.workHours.end;
            };

            // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù†Ø¸Ø§Ù…
            useEffect(() => {
                const initializeSystem = async () => {
                    try {
                        setConnectionStatus('connecting');
                        await FirebaseQueueManager.initializeDepartmentCounters();
                        
                        const stats = await FirebaseQueueManager.getAllStats();
                        setDepartmentStats(stats);
                        
                        setConnectionStatus('connected');
                        
                        if ('speechSynthesis' in window) {
                            console.log('âœ… Speech synthesis available');
                        }
                    } catch (error) {
                        console.error('âŒ Initialization error:', error);
                        setConnectionStatus('error');
                    }
                };
                
                initializeSystem();
                
                // Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ ÙÙŠ Ø§Ù„ØªØ­Ø¯ÙŠØ«Ø§Øª
                const unsubscribeTickets = FirebaseQueueManager.subscribeToTickets((newTickets) => {
                    setTickets(newTickets);
                });
                
                const unsubscribeCalls = FirebaseQueueManager.subscribeToCurrentCalls((calls) => {
                    setCurrentCalls(calls);
                });
                
                const unsubscribeUpdates = FirebaseQueueManager.subscribeToTicketUpdates((update) => {
                    setTicketUpdates(prev => [...prev, update]);
                });
                
                // Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ ÙÙŠ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª Ø§Ù„ØµÙˆØªÙŠØ©
                const unsubscribeAudio = FirebaseQueueManager.subscribeToAudioAnnouncements((announcement) => {
                    setAudioAnnouncements(prev => [...prev, announcement]);
                    
                    // Ø¥Ø°Ø§ ÙƒÙ†Ø§ ÙÙŠ Ø´Ø§Ø´Ø© Ø§Ù„Ø¹Ø±Ø¶ØŒ Ù‚Ù… Ø¨ØªØ´ØºÙŠÙ„ Ø§Ù„ØµÙˆØª
                    const urlParams = new URLSearchParams(window.location.search);
                    const isDisplayScreen = urlParams.get('view') === 'display';
                    
                    if (isDisplayScreen && announcement.action === 'call') {
                        console.log('ğŸ”Š Display screen: Playing received audio announcement');
                        setShowSoundIndicator(true);
                        setIsSoundPlaying(true);
                        
                        setCurrentAnnouncementLang('ar');
                        soundManager.announceTicket(
                            announcement.ticketNumber,
                            announcement.roomAr,
                            announcement.roomEn
                        );
                        
                        setTimeout(() => {
                            setIsSoundPlaying(false);
                            if (!soundManager.isSpeaking) {
                                setShowSoundIndicator(false);
                            }
                        }, 8000);
                    }
                });
                
                // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø¯ÙˆØ±ÙŠØ§Ù‹
                const statsInterval = setInterval(async () => {
                    const stats = await FirebaseQueueManager.getAllStats();
                    setDepartmentStats(stats);
                }, 5000);
                
                // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆÙ‚Øª
                const timeInterval = setInterval(() => {
                    setCurrentTime(new Date());
                }, 1000);
                
                // Ù…Ø±Ø§Ù‚Ø¨Ø© Ø­Ø§Ù„Ø© Ø§Ù„Ø´Ø¨ÙƒØ©
                const handleOnline = () => {
                    setIsOnline(true);
                    setConnectionStatus('connected');
                };
                
                const handleOffline = () => {
                    setIsOnline(false);
                    setConnectionStatus('disconnected');
                };
                
                window.addEventListener('online', handleOnline);
                window.addEventListener('offline', handleOffline);
                
                // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ù…Ø¹Ù„Ù…Ø© Ø§Ù„Ø¹Ø±Ø¶ ÙÙŠ Ø§Ù„Ø±Ø§Ø¨Ø·
                const urlParams = new URLSearchParams(window.location.search);
                const requestedView = urlParams.get('view');
                
                if (requestedView === 'display') {
                    setView('display');
                } else if (requestedView === 'admin') {
                    setShowAdminLogin(true);
                }
                
                return () => {
                    unsubscribeTickets();
                    unsubscribeCalls();
                    unsubscribeUpdates();
                    unsubscribeAudio();
                    clearInterval(statsInterval);
                    clearInterval(timeInterval);
                    window.removeEventListener('online', handleOnline);
                    window.removeEventListener('offline', handleOffline);
                    soundManager.stop();
                };
            }, []);

            // Ø§Ù„ØªØ¹Ø§Ù…Ù„ Ù…Ø¹ Ù†Ø¯Ø§Ø¡ Ø§Ù„ØªØ°ÙƒØ±Ø© Ø¨Ø§Ù„ØµÙˆØª
            const handleCallTicketWithSound = async (ticket) => {
                try {
                    const updatedTicket = await FirebaseQueueManager.callTicket(ticket.id);
                    const dept = CONFIG.departments.find(d => d.id === ticket.deptId);
                    
                    console.log('ğŸ« Ticket called:', updatedTicket.number);
                    
                    // Ø¥Ø°Ø§ ÙƒÙ†Ø§ ÙÙŠ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…ØŒ Ù„Ø§ Ù†Ø´ØºÙ„ Ø§Ù„ØµÙˆØª Ù…Ø­Ù„ÙŠØ§Ù‹
                    const urlParams = new URLSearchParams(window.location.search);
                    const isAdminPanel = urlParams.get('view') === 'admin' || view === 'admin';
                    
                    if (!isAdminPanel) {
                        setShowSoundIndicator(true);
                        setIsSoundPlaying(true);
                        
                        setCurrentAnnouncementLang('ar');
                        soundManager.announceTicket(
                            updatedTicket.number,
                            dept?.roomAr || updatedTicket.roomAr,
                            dept?.roomEn || updatedTicket.roomEn
                        );
                        
                        setTimeout(() => {
                            setIsSoundPlaying(false);
                            if (!soundManager.isSpeaking) {
                                setShowSoundIndicator(false);
                            }
                        }, 8000);
                    } else {
                        console.log('ğŸ”‡ Admin panel: Audio will be played on display screen only');
                    }
                    
                } catch (error) {
                    console.error('âŒ Error calling ticket:', error);
                    alert(language === 'ar' ? 'Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ù†Ø¯Ø§Ø¡ Ø§Ù„ØªØ°ÙƒØ±Ø©' : 'Error calling ticket');
                }
            };

            // ØªÙˆÙ„ÙŠØ¯ ØªØ°ÙƒØ±Ø© Ø¬Ø¯ÙŠØ¯Ø©
            const handleGenerateTicket = async (deptId) => {
                if (!isOnline) {
                    alert(language === 'ar' ? 'Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª' : 'No internet connection');
                    return;
                }
                
                setIsGeneratingTicket(true);
                try {
                    const ticket = await FirebaseQueueManager.addTicket({
                        deptId,
                        type: 'walk-in',
                        customerName: '',
                        customerPhone: '',
                        notes: ''
                    });
                    
                    setSuccessTicket(ticket);
                    
                    const stats = await FirebaseQueueManager.getDepartmentStats(deptId);
                    setDepartmentStats(prev => ({
                        ...prev,
                        [deptId]: stats
                    }));
                    
                    setTimeout(() => setSuccessTicket(null), 5000);
                    
                } catch (error) {
                    console.error('âŒ Error generating ticket:', error);
                    alert(language === 'ar' ? 'Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªÙˆÙ„ÙŠØ¯ Ø§Ù„ØªØ°ÙƒØ±Ø©' : 'Error generating ticket');
                } finally {
                    setIsGeneratingTicket(false);
                }
            };

            // Ø­Ø°Ù ØªØ°ÙƒØ±Ø©
            const handleDeleteTicket = async (ticketId) => {
                try {
                    await FirebaseQueueManager.deleteTicket(ticketId);
                    setTicketToDelete(null);
                    
                    // Ø¥Ø´Ø¹Ø§Ø± Ø§Ù„Ù†Ø¬Ø§Ø­
                    setTimeout(() => {
                        alert(t.ticketDeleted);
                    }, 300);
                    
                } catch (error) {
                    console.error('âŒ Error deleting ticket:', error);
                    alert(language === 'ar' ? 'Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø­Ø°Ù Ø§Ù„ØªØ°ÙƒØ±Ø©' : 'Error deleting ticket');
                }
            };

            // ÙØªØ­ Ù†Ø§ÙØ°Ø© Ø­Ø°Ù Ø§Ù„ØªØ°ÙƒØ±Ø©
            const openDeleteConfirmation = (ticket) => {
                setTicketToDelete(ticket);
            };

            // Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© Ø¹Ù„Ù‰ ØªØ°ÙƒØ±Ø© (ØªØªØ­Ø±Ùƒ Ù„Ù„Ø£Ø¹Ù„Ù‰ ÙÙŠ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©)
            const handleApproveTicket = async (ticketId) => {
                try {
                    await FirebaseQueueManager.approveTicket(ticketId);
                } catch (error) {
                    console.error('âŒ Error approving ticket:', error);
                }
            };

            // Ø¥Ù†Ù‡Ø§Ø¡ ØªØ°ÙƒØ±Ø©
            const handleFinishTicket = async (ticketId) => {
                try {
                    await FirebaseQueueManager.finishTicket(ticketId);
                } catch (error) {
                    console.error('âŒ Error finishing ticket:', error);
                }
            };

            // ÙØªØ­ Ù†Ø§ÙØ°Ø© Ø­Ø¬Ø² Ù…ÙˆØ¹Ø¯
            const openAppointmentModal = (deptId) => {
                setSelectedDeptForAppointment(deptId);
                setShowAppointmentModal(true);
                
                // ØªØ¹ÙŠÙŠÙ† Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ø­Ø§Ù„ÙŠ ÙƒØªØ§Ø±ÙŠØ® Ø§ÙØªØ±Ø§Ø¶ÙŠ
                const today = new Date();
                const tomorrow = new Date(today);
                tomorrow.setDate(tomorrow.getDate() + 1);
                
                // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø£ÙˆÙ„ ÙŠÙˆÙ… Ø¹Ù…Ù„ Ù…ØªØ§Ø­
                let nextWorkingDay = new Date(tomorrow);
                while (!isWorkingDay(nextWorkingDay)) {
                    nextWorkingDay.setDate(nextWorkingDay.getDate() + 1);
                }
                
                const formattedDate = nextWorkingDay.toISOString().split('T')[0];
                setAppointmentDate(formattedDate);
                
                // ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø§Ù„Ù…ØªØ§Ø­Ø© Ù„Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…Ø­Ø¯Ø¯
                const slots = generateTimeSlots(formattedDate);
                setAvailableTimeSlots(slots);
                setAppointmentTime(slots.length > 0 ? slots[0].time : '');
            };

            // Ø­Ø¬Ø² Ù…ÙˆØ¹Ø¯
            const handleBookAppointment = async () => {
                if (!appointmentDate || !appointmentTime) {
                    alert(language === 'ar' ? 'ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ØªØ§Ø±ÙŠØ® ÙˆØ§Ù„ÙˆÙ‚Øª' : 'Please select date and time');
                    return;
                }
                
                const selectedDate = new Date(appointmentDate);
                
                // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙŠÙˆÙ… Ø§Ù„Ø¹Ù…Ù„
                if (!isWorkingDay(selectedDate)) {
                    alert(language === 'ar' ? 'ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± ÙŠÙˆÙ… Ø¹Ù…Ù„ (Ù…Ù† Ø§Ù„Ø³Ø¨Øª Ø¥Ù„Ù‰ Ø§Ù„Ø®Ù…ÙŠØ³)' : 'Please select a working day (Saturday to Thursday)');
                    return;
                }
                
                // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆÙ‚Øª Ø§Ù„Ø¹Ù…Ù„
                if (!isValidWorkingTime(appointmentTime)) {
                    alert(language === 'ar' ? 'ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± ÙˆÙ‚Øª Ø®Ù„Ø§Ù„ Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ø¹Ù…Ù„ (Ù…Ù† 10 ØµØ¨Ø§Ø­Ø§Ù‹ Ø¥Ù„Ù‰ 6 Ù…Ø³Ø§Ø¡Ø§Ù‹)' : 'Please select time during working hours (10 AM to 6 PM)');
                    return;
                }
                
                setIsBookingAppointment(true);
                try {
                    const appointment = await FirebaseQueueManager.addAppointment({
                        deptId: selectedDeptForAppointment,
                        type: 'appointment',
                        appointmentDate: appointmentDate,
                        appointmentTime: appointmentTime,
                        customerName: '',
                        customerPhone: '',
                        notes: 'Ù…ÙˆØ¹Ø¯ Ù…Ø³Ø¨Ù‚'
                    });
                    
                    setAppointmentSuccess(appointment);
                    setShowAppointmentModal(false);
                    
                    setTimeout(() => setAppointmentSuccess(null), 8000);
                    
                } catch (error) {
                    console.error('âŒ Error booking appointment:', error);
                    alert(language === 'ar' ? 'Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø­Ø¬Ø² Ø§Ù„Ù…ÙˆØ¹Ø¯' : 'Error booking appointment');
                } finally {
                    setIsBookingAppointment(false);
                }
            };

            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø§Ù„Ù…ØªØ§Ø­Ø© Ø¹Ù†Ø¯ ØªØºÙŠÙŠØ± Ø§Ù„ØªØ§Ø±ÙŠØ®
            useEffect(() => {
                if (appointmentDate) {
                    const slots = generateTimeSlots(appointmentDate);
                    setAvailableTimeSlots(slots);
                    if (slots.length > 0 && !appointmentTime) {
                        setAppointmentTime(slots[0].time);
                    }
                }
            }, [appointmentDate]);

            // ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…Ø¯ÙŠØ±
            const handleAdminLogin = () => {
                if (adminCode === CONFIG.adminCode) {
                    setView('admin');
                    setShowAdminLogin(false);
                    setAdminCode('');
                    setAdminError('');
                } else {
                    setAdminError(isRTL ? 'ÙƒÙˆØ¯ Ø§Ù„Ø¯Ø®ÙˆÙ„ ØºÙŠØ± ØµØ­ÙŠØ­' : 'Incorrect access code');
                }
            };

            // ÙˆØ¸Ø§Ø¦Ù Ø§Ù„ØªÙ†Ø³ÙŠÙ‚
            const formatTime = (date) => {
                return date.toLocaleTimeString(isRTL ? 'ar-SA' : 'en-US', {
                    hour: '2-digit',
                    minute: '2-digit',
                    second: '2-digit'
                });
            };

            const formatDate = (date) => {
                return date.toLocaleDateString(isRTL ? 'ar-SA' : 'en-US', {
                    weekday: 'long',
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric'
                });
            };

            // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ù†Ø¯Ø§Ø¡ Ø§Ù„Ø­Ø§Ù„ÙŠ Ù„Ù„Ø¹Ø±Ø¶
            const getCurrentCallForDisplay = () => {
                const calls = Object.values(currentCalls);
                if (calls.length === 0) return null;
                
                const mostRecent = calls.reduce((latest, call) => {
                    return (!latest || call.calledAt > latest.calledAt) ? call : latest;
                }, null);
                
                return mostRecent;
            };

            // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„ØªØ°Ø§ÙƒØ± Ø§Ù„Ù…Ø¹ØªÙ…Ø¯Ø© (ØªØ±ØªÙŠØ¨ ØªØµØ§Ø¹Ø¯ÙŠ - Ø§Ù„Ø£Ø­Ø¯Ø« Ø£ÙˆÙ„Ø§Ù‹)
            const getApprovedTickets = () => {
                return tickets
                    .filter(t => t.status === 'waiting' && t.approved === true)
                    .sort((a, b) => {
                        // Ø§Ù„Ø£Ø­Ø¯Ø« Ø£ÙˆÙ„Ø§Ù‹ (Ø£Ø¹Ù„Ù‰ Ù‚Ø§Ø¦Ù…Ø©)
                        const timeA = a.approvedAt?.toDate?.() || new Date(a.approvedAt || 0);
                        const timeB = b.approvedAt?.toDate?.() || new Date(b.approvedAt || 0);
                        return timeB - timeA;
                    })
                    .slice(0, 5);
            };

            // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„ØªØ°Ø§ÙƒØ± Ø§Ù„Ù…Ù†ØªØ¸Ø±Ø© (ØºÙŠØ± Ø§Ù„Ù…Ø¹ØªÙ…Ø¯Ø©)
            const getWaitingTickets = () => {
                return tickets
                    .filter(t => t.status === 'waiting' && t.approved !== true)
                    .sort((a, b) => {
                        // Ø§Ù„Ø£Ù‚Ø¯Ù… Ø£ÙˆÙ„Ø§Ù‹
                        const timeA = a.createdAt?.toDate?.() || new Date(a.createdAt || 0);
                        const timeB = b.createdAt?.toDate?.() || new Date(b.createdAt || 0);
                        return timeA - timeB;
                    })
                    .slice(0, 5);
            };

            // ===== Ù…ÙƒÙˆÙ†Ø§Øª Ø§Ù„Ø¹Ø±Ø¶ =====
            
            // Ù†Ø§ÙØ°Ø© ØªØ£ÙƒÙŠØ¯ Ø­Ø°Ù Ø§Ù„ØªØ°ÙƒØ±Ø©
            const renderDeleteConfirmation = () => (
                ticketToDelete && (
                    <div className="fixed inset-0 bg-black/70 flex items-center justify-center z-50 p-4">
                        <div className="card max-w-md w-full delete-confirmation">
                            <div className="text-center space-y-6">
                                <div className="w-16 h-16 rounded-full bg-red-100 flex items-center justify-center mx-auto">
                                    <i className="fas fa-exclamation-triangle text-2xl text-red-500"></i>
                                </div>
                                <div>
                                    <h3 className="text-xl font-bold text-gray-800">{t.deleteTicket}</h3>
                                    <p className="text-gray-600 mt-2">{t.deleteConfirm}</p>
                                    <div className="mt-4 p-4 bg-gray-50 rounded-lg">
                                        <div className="text-2xl font-bold text-gray-800">
                                            {ticketToDelete.number}
                                        </div>
                                        <div className="text-gray-600 mt-1">
                                            {language === 'ar' ? ticketToDelete.departmentNameAr : ticketToDelete.departmentNameEn}
                                        </div>
                                    </div>
                                </div>
                                <div className="flex gap-3">
                                    <button
                                        onClick={() => setTicketToDelete(null)}
                                        className="flex-1 px-4 py-3 bg-gray-200 text-gray-700 rounded-lg font-medium hover:bg-gray-300 transition"
                                    >
                                        {t.cancel}
                                    </button>
                                    <button
                                        onClick={() => handleDeleteTicket(ticketToDelete.id)}
                                        className="flex-1 px-4 py-3 bg-red-600 text-white rounded-lg font-medium hover:bg-red-700 transition"
                                    >
                                        <i className="fas fa-trash mr-2"></i>
                                        {t.confirmDelete}
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                )
            );

            // Ù†Ø§ÙØ°Ø© Ø­Ø¬Ø² Ø§Ù„Ù…ÙˆØ¹Ø¯
            const renderAppointmentModal = () => (
                showAppointmentModal && (
                    <div className="fixed inset-0 bg-black/70 flex items-center justify-center z-50 p-4">
                        <div className="card max-w-lg w-full appointment-modal">
                            <div className="space-y-6">
                                <div className="flex justify-between items-center">
                                    <h3 className="text-xl font-bold text-gray-800">{t.bookAppointment}</h3>
                                    <button
                                        onClick={() => setShowAppointmentModal(false)}
                                        className="text-gray-400 hover:text-gray-600"
                                    >
                                        <i className="fas fa-times text-xl"></i>
                                    </button>
                                </div>
                                
                                {/* Ø¥Ø´Ø¹Ø§Ø± Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø§Ù„Ø¹Ù…Ù„ */}
                                <div className="work-hours-notice">
                                    <div className="flex items-start gap-2">
                                        <i className="fas fa-clock text-yellow-600 mt-1"></i>
                                        <div>
                                            <div className="font-bold mb-1 arabic">{CONFIG.workHours.messageAr}</div>
                                            <div className="text-sm english">{CONFIG.workHours.messageEn}</div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div className="space-y-4">
                                    <div>
                                        <label className="block text-gray-700 mb-2">{t.selectDate}</label>
                                        <input
                                            type="date"
                                            value={appointmentDate}
                                            onChange={(e) => setAppointmentDate(e.target.value)}
                                            className="calendar-input"
                                            min={new Date().toISOString().split('T')[0]}
                                        />
                                    </div>
                                    
                                    <div>
                                        <label className="block text-gray-700 mb-2">{t.selectTime}</label>
                                        <div className="time-slots">
                                            {availableTimeSlots.length > 0 ? (
                                                availableTimeSlots.map((slot) => (
                                                    <button
                                                        key={slot.time}
                                                        onClick={() => setAppointmentTime(slot.time)}
                                                        className={`time-slot ${appointmentTime === slot.time ? 'selected' : ''}`}
                                                    >
                                                        {slot.label}
                                                    </button>
                                                ))
                                            ) : (
                                                <div className="col-span-4 text-center py-4 text-gray-500">
                                                    <i className="fas fa-calendar-times text-2xl mb-2"></i>
                                                    <div>{t.noAvailableSlots}</div>
                                                </div>
                                            )}
                                        </div>
                                    </div>
                                    
                                    <div className="text-sm text-gray-500">
                                        <i className="fas fa-info-circle mr-2"></i>
                                        {t.appointmentInstructions}
                                    </div>
                                    
                                    <button
                                        onClick={handleBookAppointment}
                                        disabled={isBookingAppointment || !appointmentDate || !appointmentTime}
                                        className={`btn-primary w-full ${isBookingAppointment ? 'opacity-50 cursor-not-allowed' : ''}`}
                                    >
                                        {isBookingAppointment ? (
                                            <>
                                                <i className="fas fa-spinner fa-spin mr-2"></i>
                                                {t.processing}
                                            </>
                                        ) : (
                                            <>
                                                <i className="fas fa-calendar-check mr-2"></i>
                                                {t.confirmAppointment}
                                            </>
                                        )}
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                )
            );

            // Ù†Ø§ÙØ°Ø© Ù†Ø¬Ø§Ø­ Ø­Ø¬Ø² Ø§Ù„Ù…ÙˆØ¹Ø¯
            const renderAppointmentSuccess = () => (
                appointmentSuccess && (
                    <div className="fixed inset-0 bg-black/70 flex items-center justify-center z-50 p-4">
                        <div className="card max-w-md w-full bg-gradient-to-br from-green-50 to-white">
                            <div className="text-center space-y-6">
                                <div className="w-20 h-20 rounded-full bg-green-100 flex items-center justify-center mx-auto">
                                    <i className="fas fa-calendar-check text-3xl text-green-500"></i>
                                </div>
                                <div>
                                    <h3 className="text-2xl font-bold text-gray-800">{t.appointmentBooked}</h3>
                                    <div className="text-6xl font-black text-green-600 mt-4 tracking-wider">
                                        {appointmentSuccess.number}
                                    </div>
                                    <div className="mt-4 space-y-3">
                                        <div className="text-lg font-medium text-gray-700">
                                            {t.appointmentDate}: {appointmentSuccess.appointmentDate}
                                        </div>
                                        <div className="text-lg font-medium text-gray-700">
                                            {t.appointmentTime}: {appointmentSuccess.appointmentTime}
                                        </div>
                                        <div className="text-gray-600">
                                            {t.department}: {language === 'ar' ? appointmentSuccess.departmentNameAr : appointmentSuccess.departmentNameEn}
                                        </div>
                                        <div className="text-sm text-gray-500 mt-3">
                                            <i className="fas fa-info-circle mr-2"></i>
                                            {t.appointmentNote}
                                        </div>
                                    </div>
                                </div>
                                <button
                                    onClick={() => setAppointmentSuccess(null)}
                                    className="btn-success"
                                >
                                    {isRTL ? 'ØªÙ…' : 'OK'}
                                </button>
                            </div>
                        </div>
                    </div>
                )
            );

            // ÙƒØ´Ùƒ Ø§Ù„Ø²ÙˆØ§Ø± Ø§Ù„Ù…Ø­Ø³Ù† Ù„Ù„Ø£Ø¬Ù‡Ø²Ø© Ø§Ù„Ù…Ø­Ù…ÙˆÙ„Ø©
            const renderVisitorKiosk = () => (
                <div className="min-h-screen bg-gradient-to-b from-blue-50 to-gray-100">
                    {/* Ø§Ù„Ù‡ÙŠØ¯Ø± */}
                    <header className="mobile-header bg-white shadow-lg">
                        <div className="max-w-7xl mx-auto px-4 py-4">
                            <div className="flex flex-col md:flex-row justify-between items-center gap-4">
                                <div className="flex items-center gap-3">
                                    <div className="mobile-logo logo-container">
                                        <img src="https://i.ibb.co/1GHY3whz/bsxB90Z.png" alt="Al-Zahrani Logo" />
                                    </div>
                                    <div className={isRTL ? 'arabic' : 'english'}>
                                        <h1 className="mobile-text font-bold text-gray-800">
                                            {CONFIG.companyName[language]}
                                        </h1>
                                        <p className="text-sm text-blue-600">
                                            {CONFIG.systemName[language]}
                                        </p>
                                    </div>
                                </div>
                                
                                <div className="text-center">
                                    <div className="flex items-center gap-2 justify-center mb-1">
                                        <div className={`w-3 h-3 rounded-full ${isOnline ? 'bg-green-500' : 'bg-red-500 animate-pulse'}`}></div>
                                        <span className="text-sm text-gray-600">
                                            {isOnline ? t.connected : t.disconnected}
                                        </span>
                                    </div>
                                    <div className="text-xs text-gray-500">
                                        {tickets.filter(t => t.status === 'waiting').length} {t.waiting}
                                    </div>
                                </div>
                                
                                <div className="flex flex-wrap justify-center items-center gap-2">
                                    <button
                                        onClick={() => setLanguage(lang => lang === 'ar' ? 'en' : 'ar')}
                                        className="px-3 py-1.5 bg-gray-100 hover:bg-gray-200 rounded-lg flex items-center gap-2"
                                    >
                                        <span className={`font-medium ${language === 'ar' ? 'text-blue-600' : 'text-gray-600'}`}>
                                            {language === 'ar' ? 'Ø¹' : 'EN'}
                                        </span>
                                        <i className="fas fa-globe text-gray-500"></i>
                                    </button>
                                    
                                    <a
                                        href="?view=display"
                                        target="_blank"
                                        className="mobile-button btn-primary"
                                    >
                                        <i className="fas fa-tv mr-2"></i>
                                        {t.openDisplay}
                                    </a>
                                    
                                    <button
                                        onClick={() => setShowAdminLogin(true)}
                                        className="mobile-button bg-gray-100 text-gray-700 rounded-lg font-medium hover:bg-gray-200 transition"
                                    >
                                        <i className="fas fa-cog mr-2"></i>
                                        {t.employeeLogin}
                                    </button>
                                </div>
                            </div>
                        </div>
                    </header>

                    {/* Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ */}
                    <main className="mobile-optimized max-w-7xl mx-auto px-4 py-6">
                        <div className="text-center mb-8">
                            <h1 className="mobile-title font-bold text-gray-800 mb-3">
                                {t.welcome}
                            </h1>
                            <p className="mobile-text text-gray-600">
                                {t.selectDept}
                            </p>
                        </div>
                        
                        {/* Ø¥Ø´Ø¹Ø§Ø± Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø§Ù„Ø¹Ù…Ù„ */}
                        <div className="work-hours-notice mb-8">
                            <div className="flex items-center justify-between">
                                <div className="flex items-center gap-2">
                                    <i className="fas fa-clock text-yellow-600"></i>
                                    <span className="arabic">{CONFIG.workHours.messageAr}</span>
                                </div>
                                <button
                                    onClick={() => {
                                        // Ø¹Ø±Ø¶ Ø®ÙŠØ§Ø± Ø­Ø¬Ø² Ø§Ù„Ù…ÙˆØ¹Ø¯
                                        alert(language === 'ar' ? 
                                            'Ù„Ø­Ø¬Ø² Ù…ÙˆØ¹Ø¯ Ø£ÙˆÙ†Ù„Ø§ÙŠÙ†ØŒ Ø§Ø®ØªØ± Ø§Ù„Ù‚Ø³Ù… Ø«Ù… Ø§Ø®ØªØ± "Ø­Ø¬Ø² Ù…ÙˆØ¹Ø¯"' : 
                                            'To book online appointment, select department then choose "Book Appointment"');
                                    }}
                                    className="text-sm bg-yellow-500 text-white px-3 py-1 rounded-lg hover:bg-yellow-600"
                                >
                                    {t.onlineAppointment}
                                </button>
                            </div>
                        </div>
                        
                        {/* Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª */}
                        <div className="mobile-grid grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                            <div className="mobile-card card text-center">
                                <div className="text-3xl font-bold text-blue-600">
                                    {tickets.filter(t => t.status === 'waiting').length}
                                </div>
                                <div className="text-gray-600">{t.waitingList}</div>
                            </div>
                            <div className="mobile-card card text-center">
                                <div className="text-3xl font-bold text-green-600">
                                    {tickets.filter(t => t.status === 'called').length}
                                </div>
                                <div className="text-gray-600">{t.calledTickets}</div>
                            </div>
                            <div className="mobile-card card text-center">
                                <div className="text-3xl font-bold text-purple-600">
                                    {tickets.length}
                                </div>
                                <div className="text-gray-600">{t.totalAppointments}</div>
                            </div>
                        </div>
                        
                        {/* Ø§Ù„Ø£Ù‚Ø³Ø§Ù… - Ù‚Ø§Ø¨Ù„Ø© Ù„Ù„ØªÙ…Ø±ÙŠØ± */}
                        <div className="scrollable-content" style={{ maxHeight: '500px' }}>
                            <div className="mobile-grid grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-10">
                                {CONFIG.departments.map(dept => {
                                    const waitingCount = tickets.filter(t => 
                                        t.deptId === dept.id && t.status === 'waiting'
                                    ).length;
                                    
                                    const stats = departmentStats[dept.id] || { lastNumber: 0, waitingCount: 0 };
                                    
                                    return (
                                        <div key={dept.id} className="mobile-card card">
                                            <div className="flex flex-col items-center text-center">
                                                <div 
                                                    className="w-16 h-16 rounded-xl flex items-center justify-center mb-4"
                                                    style={{ backgroundColor: dept.color }}
                                                >
                                                    <i className={`${dept.icon} text-2xl text-white`}></i>
                                                </div>
                                                <h3 className="mobile-text font-bold text-gray-800 mb-2">
                                                    {language === 'ar' ? dept.nameAr : dept.nameEn}
                                                </h3>
                                                <div className="text-sm text-gray-500 mb-3">
                                                    {language === 'ar' ? dept.roomAr : dept.roomEn}
                                                </div>
                                                <div className="mt-2">
                                                    <div className="text-2xl font-bold text-gray-700">
                                                        {stats.lastNumber || 0}
                                                    </div>
                                                    <div className="text-xs text-gray-500">{t.lastNumber}</div>
                                                    {waitingCount > 0 && (
                                                        <div className="mt-2 text-sm text-blue-600">
                                                            {waitingCount} {t.waiting}
                                                        </div>
                                                    )}
                                                </div>
                                                <div className="mt-4 w-full space-y-2">
                                                    <button 
                                                        onClick={() => handleGenerateTicket(dept.id)}
                                                        disabled={isGeneratingTicket || !isOnline}
                                                        className={`mobile-button btn-primary ${isGeneratingTicket ? 'opacity-50' : ''}`}
                                                    >
                                                        {isGeneratingTicket ? (
                                                            <>
                                                                <i className="fas fa-spinner fa-spin mr-2"></i>
                                                                {t.generatingTicket}
                                                            </>
                                                        ) : (
                                                            <>
                                                                <i className="fas fa-ticket-alt mr-2"></i>
                                                                {t.generateTicket}
                                                            </>
                                                        )}
                                                    </button>
                                                    <button
                                                        onClick={() => openAppointmentModal(dept.id)}
                                                        className="mobile-button bg-gradient-to-r from-teal-500 to-teal-600 text-white rounded-lg font-medium hover:from-teal-600 hover:to-teal-700"
                                                    >
                                                        <i className="fas fa-calendar-plus mr-2"></i>
                                                        {t.onlineAppointment}
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    );
                                })}
                            </div>
                        </div>
                        
                        {/* Ø§Ù„ØªØ¹Ù„ÙŠÙ…Ø§Øª */}
                        <div className="mobile-card card bg-blue-50 border-blue-100">
                            <h3 className="text-xl font-bold text-gray-800 mb-4 flex items-center gap-2">
                                <i className="fas fa-info-circle text-blue-500"></i>
                                {t.instructions}
                            </h3>
                            <ol className={`space-y-3 text-gray-700 ${isRTL ? 'list-decimal pr-5' : 'list-decimal pl-5'}`}>
                                <li className="flex items-start gap-2">
                                    <span className="text-blue-600 font-bold">1.</span>
                                    <span>{t.instruction1}</span>
                                </li>
                                <li className="flex items-start gap-2">
                                    <span className="text-blue-600 font-bold">2.</span>
                                    <span>{t.instruction2}</span>
                                </li>
                                <li className="flex items-start gap-2">
                                    <span className="text-blue-600 font-bold">3.</span>
                                    <span>{t.instruction3}</span>
                                </li>
                                <li className="flex items-start gap-2">
                                    <span className="text-blue-600 font-bold">4.</span>
                                    <span>{t.instruction4}</span>
                                </li>
                                <li className="flex items-start gap-2">
                                    <span className="text-blue-600 font-bold">5.</span>
                                    <span>{t.instruction5}</span>
                                </li>
                            </ol>
                        </div>
                    </main>

                    {/* Ø§Ù„ÙÙˆØªØ± */}
                    <footer className="mobile-footer bg-gray-800 text-white py-6">
                        <div className="max-w-7xl mx-auto">
                            <div className="flex flex-col items-center gap-4">
                                <div className="flex items-center gap-3">
                                    <div className="logo-container" style={{ width: '60px', height: '60px' }}>
                                        <img src="https://i.ibb.co/1GHY3whz/bsxB90Z.png" alt="Al-Zahrani Logo" />
                                    </div>
                                    <div className="text-center">
                                        <div className="font-bold">{CONFIG.companyName[language]}</div>
                                        <div className="text-sm text-gray-400">{CONFIG.systemName[language]}</div>
                                    </div>
                                </div>
                                
                                <div className="text-center text-gray-300">
                                    <div>Â© 2025 {t.allRights}</div>
                                    <div className="text-sm mt-1">
                                        {t.techSupport}: {CONFIG.adminCode}
                                    </div>
                                </div>
                                
                                <div className="flex flex-wrap justify-center gap-4">
                                    <a href="?view=kiosk" className="text-gray-300 hover:text-white">
                                        {t.visitorKiosk}
                                    </a>
                                    <a href="?view=display" target="_blank" className="text-gray-300 hover:text-white">
                                        {t.displayScreen}
                                    </a>
                                    <a href="?view=admin" className="text-gray-300 hover:text-white">
                                        {t.adminPanel}
                                    </a>
                                </div>
                            </div>
                        </div>
                    </footer>
                </div>
            );

            // Ø´Ø§Ø´Ø© Ø§Ù„Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø­Ø³Ù†Ø© ÙˆØ§Ù„Ù…ØµØºØ±Ø©
            const renderProfessionalDisplay = () => {
                const currentCall = getCurrentCallForDisplay();
                const approvedTickets = getApprovedTickets();
                const waitingTickets = getWaitingTickets();
                
                return (
                    <div className="display-container">
                        {/* Ù…Ø¤Ø´Ø± Ø§Ù„ØµÙˆØª */}
                        {showSoundIndicator && (
                            <div className="sound-indicator">
                                <i className={`fas fa-volume-up sound-pulse ${currentAnnouncementLang === 'ar' ? 'text-green-400' : 'text-blue-400'}`}></i>
                                <span className="text-lg font-bold">
                                    {currentAnnouncementLang === 'ar' ? t.soundAnnouncementAr : t.soundAnnouncementEn}
                                </span>
                            </div>
                        )}
                        
                        {/* Ø§Ù„Ù‡ÙŠØ¯Ø± */}
                        <div className="display-header">
                            <div className="flex justify-between items-center">
                                <div className="flex items-center gap-4">
                                    <div className="logo-container">
                                        <img src="https://i.ibb.co/1GHY3whz/bsxB90Z.png" alt="Al-Zahrani Logo" />
                                    </div>
                                    <div>
                                        <h1 className="text-2xl font-bold arabic">
                                            {CONFIG.companyName.ar}
                                        </h1>
                                        <h1 className="text-xl font-bold english">
                                            {CONFIG.companyName.en}
                                        </h1>
                                    </div>
                                </div>
                                <div className="text-right">
                                    <div className="text-3xl font-mono font-bold">
                                        {formatTime(currentTime)}
                                    </div>
                                    <div className="text-md opacity-80">
                                        {formatDate(currentTime)}
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        {/* Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ */}
                        <div className="flex-1 flex" style={{ height: 'calc(100vh - 80px - 50px)' }}>
                            {/* Ø§Ù„Ø¬Ø²Ø¡ Ø§Ù„Ø£ÙŠØ³Ø± - Ø§Ù„Ù†Ø¯Ø§Ø¡ Ø§Ù„Ø­Ø§Ù„ÙŠ */}
                            <div className="current-call-container">
                                <div className="text-center">
                                    <div className="text-blue-400 text-3xl font-bold mb-6">
                                        {t.currentCall}
                                    </div>
                                    
                                    {currentCall ? (
                                        <>
                                            <div className="current-ticket-number">
                                                {currentCall.ticketNumber}
                                            </div>
                                            
                                            <div className="current-ticket-info">
                                                <div className="current-office arabic">
                                                    {currentCall.roomAr || "Ù…ÙƒØªØ¨ Ø§Ù„Ø®Ø¯Ù…Ø©"}
                                                </div>
                                                <div className="current-office english">
                                                    {currentCall.roomEn || "Service Office"}
                                                </div>
                                                <div className="current-department arabic">
                                                    {currentCall.categoryAr || "Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø®Ø¯Ù…Ø§Øª"}
                                                </div>
                                                <div className="current-department english">
                                                    {currentCall.categoryEn || "Service Management"}
                                                </div>
                                            </div>
                                        </>
                                    ) : (
                                        <div className="space-y-6">
                                            <div className="text-[15vw] opacity-20 text-blue-500">
                                                <i className="fas fa-clock"></i>
                                            </div>
                                            <div className="space-y-4">
                                                <div className="text-4xl text-gray-400 arabic">{t.systemReady}</div>
                                                <div className="text-3xl text-gray-400 english">{t.systemReady}</div>
                                            </div>
                                        </div>
                                    )}
                                </div>
                            </div>
                            
                            {/* Ø§Ù„Ø¬Ø²Ø¡ Ø§Ù„Ø£ÙŠÙ…Ù† - Ø§Ù„ØªØ°Ø§ÙƒØ± */}
                            <div className="tickets-sidebar">
                                {/* Ø§Ù„ØªØ°Ø§ÙƒØ± Ø§Ù„Ù…Ø¹ØªÙ…Ø¯Ø© */}
                                <div className="tickets-section">
                                    <h3 className="section-title approved-title">
                                        <i className="fas fa-check-circle"></i>
                                        {t.approvedTickets}
                                    </h3>
                                    <div className="tickets-list">
                                        {approvedTickets.length > 0 ? (
                                            approvedTickets.map((ticket, index) => {
                                                const dept = CONFIG.departments.find(d => d.id === ticket.deptId);
                                                return (
                                                    <div 
                                                        key={ticket.id}
                                                        className="display-ticket approved"
                                                        style={{ animationDelay: `${index * 0.1}s` }}
                                                    >
                                                        <div className="display-ticket-number">
                                                            {ticket.number}
                                                        </div>
                                                        <div className="display-ticket-details">
                                                            <div className="display-ticket-department arabic">
                                                                {ticket.categoryAr || dept?.categoryAr}
                                                            </div>
                                                            <div className="display-ticket-office arabic">
                                                                {ticket.roomAr}
                                                            </div>
                                                        </div>
                                                    </div>
                                                );
                                            })
                                        ) : (
                                            <div className="text-center py-6 text-gray-400">
                                                <i className="fas fa-check-circle text-2xl mb-2"></i>
                                                <div className="arabic text-lg">{t.noAppointments}</div>
                                            </div>
                                        )}
                                    </div>
                                </div>
                                
                                {/* Ø§Ù„ØªØ°Ø§ÙƒØ± Ø§Ù„Ù…Ù†ØªØ¸Ø±Ø© */}
                                <div className="tickets-section">
                                    <h3 className="section-title waiting-title">
                                        <i className="fas fa-clock"></i>
                                        {t.waitingTickets}
                                    </h3>
                                    <div className="tickets-list">
                                        {waitingTickets.length > 0 ? (
                                            waitingTickets.map((ticket, index) => {
                                                const dept = CONFIG.departments.find(d => d.id === ticket.deptId);
                                                return (
                                                    <div 
                                                        key={ticket.id}
                                                        className="display-ticket"
                                                        style={{ animationDelay: `${index * 0.1}s` }}
                                                    >
                                                        <div className="display-ticket-number">
                                                            {ticket.number}
                                                        </div>
                                                        <div className="display-ticket-details">
                                                            <div className="display-ticket-department arabic">
                                                                {ticket.categoryAr || dept?.categoryAr}
                                                            </div>
                                                            <div className="display-ticket-office arabic">
                                                                {ticket.roomAr}
                                                            </div>
                                                        </div>
                                                    </div>
                                                );
                                            })
                                        ) : (
                                            <div className="text-center py-6 text-gray-400">
                                                <i className="fas fa-clock text-2xl mb-2"></i>
                                                <div className="arabic text-lg">{t.noAppointments}</div>
                                            </div>
                                        )}
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        {/* Ø§Ù„ØªØ§ÙŠÙ…Ø± Ø§Ù„Ù…ØªØ­Ø±Ùƒ */}
                        <div className="news-ticker">
                            <div className="ticker-content arabic">
                                {t.welcomeMessage} â€¢ {t.systemMessage} â€¢ {t.holdTicket} â€¢ {CONFIG.workHours.messageAr} â€¢
                                {t.welcomeMessage} â€¢ {t.systemMessage} â€¢ {t.holdTicket} â€¢ {CONFIG.workHours.messageAr}
                            </div>
                        </div>
                    </div>
                );
            };

            // Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†
            const renderAdminPanel = () => (
                <div className="min-h-screen bg-gray-50">
                    <div className="max-w-7xl mx-auto px-4 py-8">
                        {!activeDept ? (
                            <div className="space-y-8">
                                <div className="text-center">
                                    <h1 className="text-3xl font-bold text-gray-800 mb-2">
                                        {t.controlPanel}
                                    </h1>
                                    <p className="text-gray-600">{t.selectDeptControl}</p>
                                </div>
                                
                                <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
                                    <div className="card text-center">
                                        <div className="text-3xl font-bold text-blue-600">
                                            {tickets.filter(t => t.status === 'waiting').length}
                                        </div>
                                        <div className="text-gray-600">{t.waitingList}</div>
                                    </div>
                                    <div className="card text-center">
                                        <div className="text-3xl font-bold text-green-600">
                                            {tickets.filter(t => t.status === 'called').length}
                                        </div>
                                        <div className="text-gray-600">{t.calledTickets}</div>
                                    </div>
                                    <div className="card text-center">
                                        <div className="text-3xl font-bold text-purple-600">
                                            {tickets.length}
                                        </div>
                                        <div className="text-gray-600">{t.appointments}</div>
                                    </div>
                                </div>
                                
                                <div className="admin-grid-container">
                                    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                                        {CONFIG.departments.map(dept => {
                                            const waitingCount = tickets.filter(t => 
                                                t.deptId === dept.id && t.status === 'waiting'
                                            ).length;
                                            const stats = departmentStats[dept.id] || { lastNumber: 0 };
                                            
                                            return (
                                                <button
                                                    key={dept.id}
                                                    onClick={() => setActiveDept(dept.id)}
                                                    className="card hover:border-blue-300"
                                                >
                                                    <div className="flex items-center gap-4">
                                                        <div 
                                                            className="w-14 h-14 rounded-xl flex items-center justify-center"
                                                            style={{ backgroundColor: dept.color }}
                                                        >
                                                            <i className={`${dept.icon} text-xl text-white`}></i>
                                                        </div>
                                                        <div className="text-left flex-1">
                                                            <h3 className="font-bold text-gray-800">
                                                                {language === 'ar' ? dept.nameAr : dept.nameEn}
                                                            </h3>
                                                            <p className="text-sm text-gray-500">
                                                                {language === 'ar' ? dept.roomAr : dept.roomEn}
                                                            </p>
                                                            <div className="mt-2">
                                                                <div className="flex justify-between items-center">
                                                                    <span className="text-gray-600">{t.waiting}:</span>
                                                                    <span className="text-xl font-bold" style={{ color: dept.color }}>
                                                                        {waitingCount}
                                                                    </span>
                                                                </div>
                                                                <div className="flex justify-between items-center mt-1">
                                                                    <span className="text-gray-600">{t.lastNumber}:</span>
                                                                    <span className="text-lg font-bold">
                                                                        {stats.lastNumber || 0}
                                                                    </span>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </button>
                                            );
                                        })}
                                    </div>
                                </div>
                                
                                <div className="flex justify-center gap-4 pb-8">
                                    <a
                                        href="?view=kiosk"
                                        className="px-6 py-3 bg-gray-200 text-gray-700 rounded-lg font-medium hover:bg-gray-300 transition"
                                    >
                                        {t.returnToKiosk}
                                    </a>
                                    <a
                                        href="?view=display"
                                        target="_blank"
                                        className="px-6 py-3 bg-green-600 text-white rounded-lg font-medium hover:bg-green-700 transition"
                                    >
                                        {t.openDisplay}
                                    </a>
                                </div>
                            </div>
                        ) : (
                            <div className="space-y-6">
                                <div className="card bg-gradient-to-r from-blue-600 to-blue-700 text-white">
                                    <div className="flex justify-between items-center">
                                        <div className="flex items-center gap-4">
                                            <button
                                                onClick={() => setActiveDept(null)}
                                                className="bg-white/20 hover:bg-white/30 p-2 rounded-lg transition"
                                            >
                                                <i className="fas fa-arrow-left text-xl"></i>
                                            </button>
                                            <div>
                                                <h2 className="text-2xl font-bold">
                                                    {language === 'ar' ? 
                                                        CONFIG.departments.find(d => d.id === activeDept)?.nameAr :
                                                        CONFIG.departments.find(d => d.id === activeDept)?.nameEn}
                                                </h2>
                                                <p className="opacity-90">
                                                    {language === 'ar' ? 
                                                        CONFIG.departments.find(d => d.id === activeDept)?.roomAr :
                                                        CONFIG.departments.find(d => d.id === activeDept)?.roomEn}
                                                </p>
                                            </div>
                                        </div>
                                        <div className="text-center">
                                            <div className="text-3xl font-bold">
                                                {(departmentStats[activeDept]?.lastNumber || 0)}
                                            </div>
                                            <div className="text-sm opacity-80">{t.lastNumber}</div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
                                    {/* Ø§Ù„ØªØ°Ø§ÙƒØ± Ø§Ù„Ù…Ù†ØªØ¸Ø±Ø© */}
                                    <div className="card">
                                        <h3 className="text-xl font-bold text-gray-800 mb-4">
                                            {t.waitingList} ({tickets.filter(t => t.deptId === activeDept && t.status === 'waiting').length})
                                        </h3>
                                        <div className="space-y-3 max-h-96 overflow-y-auto">
                                            {tickets
                                                .filter(t => t.deptId === activeDept && t.status === 'waiting')
                                                .sort((a, b) => a.createdAt - b.createdAt)
                                                .map(ticket => (
                                                    <div key={ticket.id} className="compact-ticket">
                                                        <div className="flex justify-between items-center">
                                                            <div>
                                                                <div className="flex items-center gap-2">
                                                                    <div className="compact-ticket-number">
                                                                        {ticket.number}
                                                                    </div>
                                                                    {ticket.approved ? (
                                                                        <span className="ticket-badge approved-badge">
                                                                            {t.approved}
                                                                        </span>
                                                                    ) : (
                                                                        <span className="ticket-badge waiting-badge">
                                                                            {t.waiting}
                                                                        </span>
                                                                    )}
                                                                </div>
                                                                <div className="compact-ticket-info">
                                                                    {formatTime(ticket.createdAt?.toDate?.() || new Date(ticket.createdAt))}
                                                                </div>
                                                            </div>
                                                            <div className="flex gap-2">
                                                                {!ticket.approved && (
                                                                    <button
                                                                        onClick={() => handleApproveTicket(ticket.id)}
                                                                        className="btn-success"
                                                                    >
                                                                        <i className="fas fa-check mr-2"></i>
                                                                        {t.approved}
                                                                    </button>
                                                                )}
                                                                <button
                                                                    onClick={() => handleCallTicketWithSound(ticket)}
                                                                    className="btn-primary"
                                                                >
                                                                    <i className="fas fa-bullhorn mr-2"></i>
                                                                    {t.call}
                                                                </button>
                                                                <button
                                                                    onClick={() => openDeleteConfirmation(ticket)}
                                                                    className="btn-danger"
                                                                >
                                                                    <i className="fas fa-trash mr-2"></i>
                                                                    {t.delete}
                                                                </button>
                                                            </div>
                                                        </div>
                                                    </div>
                                                ))}
                                            
                                            {tickets.filter(t => t.deptId === activeDept && t.status === 'waiting').length === 0 && (
                                                <div className="text-center py-4 text-gray-500">
                                                    <i className="fas fa-clock text-2xl mb-2"></i>
                                                    <div>{language === 'ar' ? 'Ù„Ø§ ØªÙˆØ¬Ø¯ ØªØ°Ø§ÙƒØ± ÙÙŠ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±' : 'No tickets waiting'}</div>
                                                </div>
                                            )}
                                        </div>
                                    </div>
                                    
                                    {/* Ø§Ù„ØªØ°Ø§ÙƒØ± Ø§Ù„Ù…Ù†Ø¯Ø§Ø¡ Ø¹Ù„ÙŠÙ‡Ø§ */}
                                    <div className="card">
                                        <h3 className="text-xl font-bold text-gray-800 mb-4">
                                            {t.calledTickets} ({tickets.filter(t => t.deptId === activeDept && t.status === 'called').length})
                                        </h3>
                                        <div className="space-y-3 max-h-96 overflow-y-auto">
                                            {tickets
                                                .filter(t => t.deptId === activeDept && t.status === 'called')
                                                .sort((a, b) => (b.calledAt || 0) - (a.calledAt || 0))
                                                .map(ticket => (
                                                    <div key={ticket.id} className="p-4 bg-gradient-to-r from-green-50 to-emerald-50 rounded-lg border border-green-200">
                                                        <div className="text-center mb-4">
                                                            <div className="text-3xl font-bold text-gray-800">
                                                                {ticket.number}
                                                            </div>
                                                            <div className="text-sm text-gray-500">
                                                                {formatTime(ticket.calledAt?.toDate?.() || new Date(ticket.calledAt))}
                                                            </div>
                                                        </div>
                                                        <div className="flex gap-2">
                                                            <button
                                                                onClick={() => handleCallTicketWithSound(ticket)}
                                                                className="btn-success flex-1"
                                                            >
                                                                <i className="fas fa-redo mr-2"></i>
                                                                {t.recall}
                                                            </button>
                                                            <button
                                                                onClick={() => handleFinishTicket(ticket.id)}
                                                                className="btn-danger flex-1"
                                                            >
                                                                <i className="fas fa-check mr-2"></i>
                                                                {t.finish}
                                                            </button>
                                                        </div>
                                                    </div>
                                                ))}
                                            
                                            {tickets.filter(t => t.deptId === activeDept && t.status === 'called').length === 0 && (
                                                <div className="text-center py-4 text-gray-500">
                                                    <i className="fas fa-bullhorn text-2xl mb-2"></i>
                                                    <div>{language === 'ar' ? 'Ù„Ø§ ØªÙˆØ¬Ø¯ ØªØ°Ø§ÙƒØ± Ù…Ù†Ø§Ø¯Ø§Ø©' : 'No tickets called'}</div>
                                                </div>
                                            )}
                                        </div>
                                    </div>
                                </div>
                            </div>
                        )}
                    </div>
                </div>
            );

            // ===== Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ =====
            return (
                <div className="min-h-screen flex flex-col" dir={isRTL ? 'rtl' : 'ltr'}>
                    {/* Ø­Ø§Ù„Ø© Ø§Ù„Ø§ØªØµØ§Ù„ */}
                    <div className={`connection-status ${isOnline ? 'connected' : 'disconnected'}`}>
                        <i className={`fas fa-${isOnline ? 'wifi' : 'wifi-slash'}`}></i>
                        <span>{isOnline ? t.connected : t.disconnected}</span>
                    </div>

                    {/* Ù†Ø§ÙØ°Ø© ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…Ø¯ÙŠØ± */}
                    {showAdminLogin && (
                        <div className="fixed inset-0 bg-black/70 flex items-center justify-center z-50 p-4">
                            <div className="card max-w-md w-full">
                                <div className="text-center space-y-6">
                                    <div>
                                        <i className="fas fa-lock text-4xl text-blue-500 mb-4"></i>
                                        <h2 className="text-2xl font-bold text-gray-800">{t.employeeLogin}</h2>
                                        <p className="text-gray-600 mt-2">{t.enterCode}</p>
                                    </div>
                                    
                                    <div className="space-y-4">
                                        <input
                                            type="password"
                                            value={adminCode}
                                            onChange={(e) => setAdminCode(e.target.value)}
                                            placeholder={isRTL ? "Ø£Ø¯Ø®Ù„ Ø§Ù„ÙƒÙˆØ¯ Ù‡Ù†Ø§" : "Enter code here"}
                                            className="w-full p-3 border border-gray-300 rounded-lg text-center text-xl font-mono"
                                            autoFocus
                                            onKeyPress={(e) => e.key === 'Enter' && handleAdminLogin()}
                                        />
                                        
                                        {adminError && (
                                            <div className="text-red-500 font-medium animate-slide-in">
                                                {adminError}
                                            </div>
                                        )}
                                        
                                        <button
                                            onClick={handleAdminLogin}
                                            className="btn-primary w-full"
                                        >
                                            {isRTL ? 'Ø¯Ø®ÙˆÙ„' : 'Login'}
                                        </button>
                                    </div>
                                    
                                    <button
                                        onClick={() => {
                                            setShowAdminLogin(false);
                                            setAdminCode('');
                                            setAdminError('');
                                        }}
                                        className="text-gray-500 hover:text-gray-700"
                                    >
                                        {isRTL ? 'Ø¥Ù„ØºØ§Ø¡' : 'Cancel'}
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* Ù†Ø§ÙØ°Ø© Ù†Ø¬Ø§Ø­ ØªÙˆÙ„ÙŠØ¯ Ø§Ù„ØªØ°ÙƒØ±Ø© */}
                    {successTicket && (
                        <div className="fixed inset-0 bg-black/70 flex items-center justify-center z-50 p-4">
                            <div className="card max-w-md w-full bg-gradient-to-br from-blue-50 to-white">
                                <div className="text-center space-y-6">
                                    <div className="w-20 h-20 rounded-full bg-blue-100 flex items-center justify-center mx-auto">
                                        <i className="fas fa-ticket-alt text-3xl text-blue-500"></i>
                                    </div>
                                    <div>
                                        <h3 className="text-2xl font-bold text-gray-800">{t.ticketGenerated}</h3>
                                        <div className="text-6xl font-black text-blue-600 mt-4 tracking-wider">
                                            {successTicket.number}
                                        </div>
                                        <div className="mt-4 space-y-2">
                                            <div className="text-lg font-medium text-gray-700">
                                                {t.department}: {language === 'ar' ? successTicket.departmentNameAr : successTicket.departmentNameEn}
                                            </div>
                                            <div className="text-gray-600">
                                                {t.waitForCall}
                                            </div>
                                        </div>
                                    </div>
                                    <button
                                        onClick={() => setSuccessTicket(null)}
                                        className="btn-primary"
                                    >
                                        {isRTL ? 'ØªÙ…' : 'OK'}
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* Ù†Ø§ÙØ°Ø© ØªØ£ÙƒÙŠØ¯ Ø­Ø°Ù Ø§Ù„ØªØ°ÙƒØ±Ø© */}
                    {renderDeleteConfirmation()}
                    
                    {/* Ù†Ø§ÙØ°Ø© Ø­Ø¬Ø² Ø§Ù„Ù…ÙˆØ¹Ø¯ */}
                    {renderAppointmentModal()}
                    
                    {/* Ù†Ø§ÙØ°Ø© Ù†Ø¬Ø§Ø­ Ø­Ø¬Ø² Ø§Ù„Ù…ÙˆØ¹Ø¯ */}
                    {renderAppointmentSuccess()}

                    {/* Ø§Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø­Ø§Ù„ÙŠ */}
                    {view === 'kiosk' && renderVisitorKiosk()}
                    {view === 'display' && renderProfessionalDisplay()}
                    {view === 'admin' && renderAdminPanel()}
                </div>
            );
        }

        // ØªØµÙŠÙŠØ± Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
